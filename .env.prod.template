# Production Environment Variables Template
# =========================================
# Copy this file to .env.prod and update values for your production environment
# Command: cp .env.prod.template .env.prod && chmod 600 .env.prod

# ===========================================
# REQUIRED VARIABLES (UPDATE!)
# ===========================================

# Database - UPDATE for your production database
DATABASE_URL=postgresql://books_app:CHANGE_THIS_STRONG_PASSWORD@postgres:5432/books_app?schema=public

# JWT Secrets - GENERATE NEW KEYS!
# Use: openssl rand -base64 32
JWT_ACCESS_SECRET=GENERATE_NEW_32_CHAR_SECRET_HERE
JWT_REFRESH_SECRET=GENERATE_NEW_32_CHAR_SECRET_HERE

# Admin Users - SPECIFY REAL EMAIL ADDRESSES
ADMIN_EMAILS=admin@yourdomain.com
CONTENT_MANAGER_EMAILS=editor@yourdomain.com

# Domain Configuration - UPDATE FOR YOUR DOMAIN
# LOCAL_PUBLIC_BASE_URL - base URL for generating static file links
# CORS_ORIGIN - allowed origins for CORS (comma-separated)
LOCAL_PUBLIC_BASE_URL=https://api.bibliaris.com
CORS_ORIGIN=https://bibliaris.com,http://localhost:3000,http://localhost:3001

# ===========================================
# PRODUCTION SETTINGS (DO NOT CHANGE!)
# ===========================================

# Environment
NODE_ENV=production

# Server
PORT=5000
HOST=0.0.0.0

# JWT Configuration
JWT_ACCESS_EXPIRES_IN=12h
JWT_REFRESH_EXPIRES_IN=7d

# Language Policy
DEFAULT_LANGUAGE=en

# CORS Configuration
# CORS_CREDENTIALS - enable credentials (cookies) for CORS requests
# Set to 1 only if frontend uses withCredentials: true or credentials: 'include'
CORS_CREDENTIALS=1

# ===========================================
# SECURITY SETTINGS (CRITICAL FOR PRODUCTION!)
# ===========================================

# Rate Limiting - ENABLED for protection
RATE_LIMIT_GLOBAL_ENABLED=1
RATE_LIMIT_GLOBAL_MAX=100
RATE_LIMIT_GLOBAL_WINDOW_MS=60000

# Comments Rate Limiting
RATE_LIMIT_ENABLED=1
RATE_LIMIT_COMMENTS_PER_MINUTE=10
RATE_LIMIT_COMMENTS_WINDOW_MS=60000

# Auth Rate Limiting - brute-force protection
RATE_LIMIT_AUTH_ENABLED=1
# Login limits (password brute-force defense)
RATE_LIMIT_LOGIN_MAX=5
RATE_LIMIT_LOGIN_WINDOW_MS=60000
# Register limits (spam registration defense)
RATE_LIMIT_REGISTER_MAX=3
RATE_LIMIT_REGISTER_WINDOW_MS=300000
# Refresh token limits
RATE_LIMIT_REFRESH_MAX=10
RATE_LIMIT_REFRESH_WINDOW_MS=60000

# Proxy Trust - ENABLED when behind reverse proxy
TRUST_PROXY=1

# Roles Cache
ROLES_CACHE_TTL_MS=5000

# ===========================================
# UPLOADS & STORAGE
# ===========================================

# Local Uploads
LOCAL_UPLOADS_DIR=var/uploads

# Upload Limits (in megabytes)
UPLOADS_MAX_IMAGE_MB=5
UPLOADS_MAX_AUDIO_MB=100
UPLOADS_PRESIGN_TTL_SEC=600

# Allowed Content Types
UPLOADS_ALLOWED_IMAGE_CT=image/jpeg,image/png,image/webp
UPLOADS_ALLOWED_AUDIO_CT=audio/mpeg,audio/mp4,audio/aac,audio/ogg

# ===========================================
# PERFORMANCE & CACHING
# ===========================================

# Cache TTLs (milliseconds)
SITEMAP_CACHE_TTL_MS=60000
VIEWS_CACHE_TTL_MS=30000
# SEO_CACHE_TTL_MS=300000  # uncomment if needed

# Body Limits
BODY_LIMIT_JSON=1mb
BODY_LIMIT_URLENCODED=1mb

# ===========================================
# DATABASE CONFIGURATION (POSTGRES)
# ===========================================

# PostgreSQL Settings (for docker-compose.prod.yml)
POSTGRES_DB=books_app
POSTGRES_USER=books_app
POSTGRES_PASSWORD=CHANGE_THIS_STRONG_PASSWORD
POSTGRES_PORT=5432

# ===========================================
# REDIS CONFIGURATION (OPTIONAL)
# ===========================================

# Redis for BullMQ (uncomment if used)
# REDIS_HOST=redis
# REDIS_PORT=6379
# REDIS_PASSWORD=CHANGE_THIS_IF_USED
# REDIS_URL=redis://redis:6379

# BullMQ Settings
# BULLMQ_IN_PROCESS_WORKER=0
# BULLMQ_DEMO_QUEUE=demo
# BULLMQ_DEMO_CONCURRENCY=2
# BULLMQ_WORKER_LOG_LEVEL=info
# BULLMQ_WORKER_SHUTDOWN_TIMEOUT_MS=5000

# ===========================================
# MONITORING & LOGGING (OPTIONAL)
# ===========================================

# Sentry (uncomment when used)
# SENTRY_DSN=https://your-sentry-dsn-here
# SENTRY_ENVIRONMENT=production
# SENTRY_TRACES_SAMPLE_RATE=0.1

# Log Level
# LOG_LEVEL=info

# ===========================================
# EXTERNAL SERVICES (OPTIONAL)
# ===========================================

# Email Service (uncomment when configuring)
# SMTP_HOST=smtp.yourdomain.com
# SMTP_PORT=587
# SMTP_USER=noreply@yourdomain.com
# SMTP_PASS=your_smtp_password
# SMTP_FROM=noreply@yourdomain.com

# S3/R2 Storage (uncomment when migrating from local storage)
# R2_ACCOUNT_ID=your_account_id
# R2_ACCESS_KEY_ID=your_access_key
# R2_SECRET_ACCESS_KEY=your_secret_key
# R2_BUCKET=books-media
# R2_ENDPOINT=https://account_id.r2.cloudflarestorage.com
# R2_PUBLIC_BASE_URL=https://media.yourdomain.com

# ===========================================
# EXAMPLE COMMANDS FOR SECRET GENERATION
# ===========================================

# JWT secrets (run these commands and copy output):
# openssl rand -base64 32
# openssl rand -base64 32

# PostgreSQL password (generate a strong password):
# openssl rand -base64 24

# ===========================================
# IMPORTANT NOTES
# ===========================================

# 1. NEVER commit .env.prod to git!
# 2. Set read-only permissions: chmod 600 .env.prod
# 3. Keep a secure backup of settings
# 4. Use strong passwords (24+ characters)
# 5. Rotate JWT secrets regularly in production
# 6. Verify settings with: ./scripts/check_prod_config.js

# ===========================================
# CONFIGURATION VERIFICATION
# ===========================================

# After creating .env.prod run checks:
# node check_prod_config.js
# ./scripts/health_check.sh --url http://localhost:5000

# To check the production server:
# ./scripts/health_check.sh --url https://api.yourdomain.com

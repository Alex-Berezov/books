–†–∞–∑–Ω–æ–µ:

- –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç yarn (classic) ‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ npm. –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —á–µ—Ä–µ–∑ yarn —Å–∫—Ä–∏–ø—Ç—ã.

## üåê PRODUCTION: Backend —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ VPS

**‚úÖ Production API —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –∞–¥—Ä–µ—Å—É: https://api.bibliaris.com**

### –í–∞–∂–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

- **Backend –£–ñ–ï –†–ê–ó–í–ï–†–ù–£–¢** –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ (bibliaris.com)
- **–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ production API, –∞ –Ω–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
- **–ù–µ –Ω—É–∂–Ω–æ** –∑–∞–ø—É—Å–∫–∞—Ç—å Docker –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API
- **–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ GitHub Actions –ø—Ä–∏ push –≤ `main`

### Production URLs:

- **API Base URL**: https://api.bibliaris.com/api
- **API Health**: https://api.bibliaris.com/api/health/liveness
- **API Docs (Swagger)**: https://api.bibliaris.com/docs
- **Metrics**: https://api.bibliaris.com/api/metrics

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:

–õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã:

- –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ –Ω–æ–≤—ã–µ features –≤ backend –∫–æ–¥–µ
- –ó–∞–ø—É—Å–∫–∞–µ—Ç–µ E2E —Ç–µ—Å—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ
- –û—Ç–ª–∞–∂–∏–≤–∞–µ—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

–î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ (frontend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ production URL.

**–°–º. —Ç–∞–∫–∂–µ:**

- [docs/PRODUCTION_QUICK_COMMANDS.md](docs/PRODUCTION_QUICK_COMMANDS.md) - –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è production
- [docs/PRODUCTION_DEPLOYMENT_GUIDE.md](docs/PRODUCTION_DEPLOYMENT_GUIDE.md) - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ—é

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

- **`.env`** - –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–≤ `.gitignore`, —Å–æ–∑–¥–∞–π—Ç–µ –∏–∑ `.env.example`)
- **`.env.test`** - E2E —Ç–µ—Å—Ç—ã (**–∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ Git**, —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–µ credentials)
- **`.env.prod`** - production —Å–µ–∫—Ä–µ—Ç—ã (**–≤ `.gitignore`, –ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!**)

### Production —Å–µ–∫—Ä–µ—Ç—ã:

**–ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env.prod` –≤ Git!**

- `.env.prod` —Å–æ–¥–µ—Ä–∂–∏—Ç production —Å–µ–∫—Ä–µ—Ç—ã (–ø–∞—Ä–æ–ª–∏ –ë–î, API –∫–ª—é—á–∏)
- –§–∞–π–ª —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore` - –æ–Ω –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env.prod.template` –∫–∞–∫ –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ü—Ä–∏ –¥–µ–ø–ª–æ–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `.env.prod` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –í GitHub Actions –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è secret `ENV_PROD` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### Test credentials:

`.env.test` –±–µ–∑–æ–ø–∞—Å–Ω–æ –∫–æ–º–º–∏—Ç–∏—Ç—å, —Ç–∞–∫ –∫–∞–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–µ credentials:

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è E2E —Ç–µ—Å—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ GitHub Actions CI/CD
- –¢—Ä–µ–±—É–µ—Ç PostgreSQL —Å –ø—Ä–∞–≤–∞–º–∏ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ë–î

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è (–ª–æ–∫–∞–ª—å–Ω–æ)

- Node.js 22+
- Yarn (classic) 1.x ‚Äî –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ yarn, npm –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- PostgreSQL 14+ (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≤ Docker)
- Git

–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (—Å yarn):

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: `yarn`
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client: `yarn prisma:generate`
–ú–∏–≥—Ä–∞—Ü–∏–∏ dev: `yarn prisma:migrate`
–°–∏–¥—ã: `yarn prisma:seed`
–ó–∞–ø—É—Å–∫ dev: `yarn start:dev`
E2E —Ç–µ—Å—Ç—ã: `yarn test:e2e`

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û–ï –ü–†–ê–í–ò–õ–û –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–û–í

### ‚ö†Ô∏è –í–°–ï–ì–î–ê –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –ü–ï–†–ï–î commit –∏ push!

**–ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º `git push` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ TypeScript
yarn typecheck

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–∞
yarn lint

# 3. Unit —Ç–µ—Å—Ç—ã
yarn test

# 4. E2E —Ç–µ—Å—Ç—ã (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ –∫ –≤–∞—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º)
yarn test:e2e
```

**–ü—Ä–∞–≤–∏–ª–æ:** –ö–æ–º–º–∏—Ç—å—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**

- Push –≤ `main` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ production —á–µ—Ä–µ–∑ GitHub Actions
- –ü–∞–¥–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç —Å–ª–æ–º–∞—Ç—å production —Å–∞–π—Ç bibliaris.com
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 1-2 –º–∏–Ω—É—Ç—ã, –Ω–æ —ç–∫–æ–Ω–æ–º–∏—Ç —á–∞—Å—ã –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ production

**–ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:**

```bash
yarn ci  # –ó–∞–ø—É—Å–∫–∞–µ—Ç typecheck, lint –∏ –≤—Å–µ —Ç–µ—Å—Ç—ã
```

---

<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://nestjs.com/img/logo-small.svg" width="120" alt="Nest Logo" /></a>
</p>

[circleci-image]: https://img.shields.io/circleci/build/github/nestjs/nest/master?token=abc123def456
[circleci-url]: https://circleci.com/gh/nestjs/nest

  <p align="center">A progressive <a href="http://nodejs.org" target="_blank">Node.js</a> framework for building efficient and scalable server-side applications.</p>
    <p align="center">
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/v/@nestjs/core.svg" alt="NPM Version" /></a>
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/l/@nestjs/core.svg" alt="Package License" /></a>
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/dm/@nestjs/common.svg" alt="NPM Downloads" /></a>
<a href="https://circleci.com/gh/nestjs/nest" target="_blank"><img src="https://img.shields.io/circleci/build/github/nestjs/nest/master" alt="CircleCI" /></a>
<a href="https://discord.gg/G7Qnnhy" target="_blank"><img src="https://img.shields.io/badge/discord-online-brightgreen.svg" alt="Discord"/></a>
<a href="https://opencollective.com/nest#backer" target="_blank"><img src="https://opencollective.com/nest/backers/badge.svg" alt="Backers on Open Collective" /></a>
<a href="https://opencollective.com/nest#sponsor" target="_blank"><img src="https://opencollective.com/nest/sponsors/badge.svg" alt="Sponsors on Open Collective" /></a>
  <a href="https://paypal.me/kamilmysliwiec" target="_blank"><img src="https://img.shields.io/badge/Donate-PayPal-ff3f59.svg" alt="Donate us"/></a>
    <a href="https://opencollective.com/nest#sponsor"  target="_blank"><img src="https://img.shields.io/badge/Support%20us-Open%20Collective-41B883.svg" alt="Support us"></a>
  <a href="https://twitter.com/nestframework" target="_blank"><img src="https://img.shields.io/twitter/follow/nestframework.svg?style=social&label=Follow" alt="Follow us on Twitter"></a>
</p>
  <!--[![Backers on Open Collective](https://opencollective.com/nest/backers/badge.svg)](https://opencollective.com/nest#backer)
  [![Sponsors on Open Collective](https://opencollective.com/nest/sponsors/badge.svg)](https://opencollective.com/nest#sponsor)-->

## Description

[Nest](https://github.com/nestjs/nest) framework TypeScript starter repository.

## Project setup

```bash
$ yarn install
```

## –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Å –Ω—É–ª—è

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `yarn`
2. –°–æ–∑–¥–∞–π—Ç–µ `.env` (—Å–º. —Ä–∞–∑–¥–µ–ª ¬´–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è¬ª): –∑–∞–¥–∞–π—Ç–µ `DATABASE_URL`
3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª–∏–µ–Ω—Ç Prisma:

```bash
yarn prisma:migrate
yarn prisma:generate
```

4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –Ω–∞–ø–æ–ª–Ω–∏—Ç–µ dev-–¥–∞–Ω–Ω—ã–º–∏: `yarn prisma:seed`
5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ dev-—Ä–µ–∂–∏–º–µ: `yarn start:dev` (–∏–ª–∏ VS Code –∑–∞–¥–∞—á–∞ ¬´dev¬ª)
6. Swagger –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: http://localhost:5000/docs
7. –ú–µ—Ç—Ä–∏–∫–∏ Prometheus: http://localhost:5000/api/metrics

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose (dev)

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω PostgreSQL/Redis –ª–æ–∫–∞–ª—å–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π compose:

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` ‚Üí `.env` –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `DATABASE_URL` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ `postgres://postgres:postgres@localhost:5432/books?schema=public`).

2. –ü–æ–¥–Ω–∏–º–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã –ë–î –∏ Redis:

```bash
docker compose up -d
```

3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ Prisma Client:

```bash
yarn prisma:migrate
yarn prisma:generate
```

4. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–¥—ã:

```bash
yarn prisma:seed
```

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

````bash
yarn start:dev

6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ Prometheus:

```bash
curl -s http://localhost:5000/metrics | head -n 20
````

````

–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
docker compose down
````

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:

- –î–∞–Ω–Ω—ã–µ Postgres —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–æ–º volume `postgres_data`.
- –ü–æ—Ä—Ç—ã: Postgres `5432`, Redis `6379` (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`).
- Redis –¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–¥–∞—á (–∫—ç—à/–æ—á–µ—Ä–µ–¥–∏); —Ç–µ–∫—É—â–∏–π –∫–æ–¥ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –Ω–µ–≥–æ.

### –û—á–µ—Ä–µ–¥–∏ (BullMQ) ‚Äî –±–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è BullMQ —Å Redis. –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `REDIS_URL` –∏–ª–∏ `REDIS_HOST`/`REDIS_PORT` –º–æ–¥—É–ª—å –æ—á–µ—Ä–µ–¥–µ–π –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—É—é –æ—á–µ—Ä–µ–¥—å `demo` —Å –≤–æ—Ä–∫–µ—Ä–æ–º.
- **–í–∞–∂–Ω–æ**: BullMQ —Ç—Ä–µ–±—É–µ—Ç `maxRetriesPerRequest: null` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Redis –¥–ª—è –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (Worker, QueueEvents). –≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ `QueueModule`.
- –ê–¥–º–∏–Ω-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (Auth + Role Admin):
  - `GET /queues/status` ‚Äî —Å—Ç–∞—Ç—É—Å –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π (enabled: true|false)
  - `GET /queues/demo/stats` ‚Äî —Å—á—ë—Ç—á–∏–∫–∏ –æ—á–µ—Ä–µ–¥–∏ demo
  - `POST /queues/demo/enqueue` ‚Äî –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–¥–∞—á—É `{ delayMs?: number }`
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
  - `REDIS_URL` –∏–ª–∏ `REDIS_HOST`/`REDIS_PORT` (+ `REDIS_PASSWORD`)
  - `BULLMQ_DEMO_QUEUE` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é demo)
  - `BULLMQ_DEMO_CONCURRENCY` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2)
  - `BULLMQ_IN_PROCESS_WORKER` (0/1) ‚Äî –∑–∞–ø—É—Å–∫ in-process –≤–æ—Ä–∫–µ—Ä–∞ –≤–º–µ—Å—Ç–µ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º (dev –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
  - `BULLMQ_WORKER_LOG_LEVEL` ‚Äî —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ—Ä–∫–µ—Ä–∞: debug|info|warn|error (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é info)
  - `BULLMQ_WORKER_SHUTDOWN_TIMEOUT_MS` ‚Äî —Ç–∞–π–º–∞—É—Ç graceful shutdown –≤–æ—Ä–∫–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5000)
- –ï—Å–ª–∏ Redis –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Äî –º–æ–¥—É–ª—å –æ—á–µ—Ä–µ–¥–µ–π –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏; health/readiness –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, Redis –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `skipped`.
- **Graceful shutdown**: –º–æ–¥—É–ª—å —Ä–µ–∞–ª–∏–∑—É–µ—Ç `onModuleDestroy` lifecycle hook –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –≤–æ—Ä–∫–µ—Ä–æ–≤, –æ—á–µ—Ä–µ–¥–µ–π –∏ Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –≤ —Ç–µ—Å—Ç–∞—Ö.

#### –û—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤–æ—Ä–∫–µ—Ä–∞

- –ó–∞–ø—É—Å–∫ –¥–µ–º–æ‚Äë–≤–æ—Ä–∫–µ—Ä–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ: `yarn worker:demo`.
- –í–æ—Ä–∫–µ—Ä—Ç —á–∏—Ç–∞–µ—Ç —Ç–µ –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Redis (`REDIS_URL` –∏–ª–∏ `REDIS_HOST`/`REDIS_PORT`/`REDIS_PASSWORD`), –∞ —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∏ –≤—ã—à–µ (`BULLMQ_DEMO_QUEUE`, `BULLMQ_DEMO_CONCURRENCY`, `BULLMQ_WORKER_LOG_LEVEL`, `BULLMQ_WORKER_SHUTDOWN_TIMEOUT_MS`).

## üöÄ Production Deployment

‚úÖ **Production —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç**: [bibliaris.com](https://bibliaris.com)

### üöÄ –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è Production

**üìñ –°–º. [docs/PRODUCTION_QUICK_COMMANDS.md](docs/PRODUCTION_QUICK_COMMANDS.md)** - –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è production.

–°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:

```bash
# SSH –¥–æ—Å—Ç—É–ø
ssh deploy@bibliaris.com

# –í–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å Swagger
./scripts/toggle_swagger.sh enable
./scripts/toggle_swagger.sh disable

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker compose --profile prod -f docker-compose.prod.yml logs -f app

# Health checks
curl https://bibliaris.com/api/health/liveness
```

### –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –≤ production

**–í–∞–∂–Ω–æ**: –î–µ–ø–ª–æ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GitHub Secrets –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è `.env.prod`. –°–º. [GITHUB_SECRETS_SETUP.md](docs/GITHUB_SECRETS_SETUP.md) –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub Secrets (–æ–¥–∏–Ω —Ä–∞–∑):
# - –°–æ–∑–¥–∞–π—Ç–µ ENV_PROD secret —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º .env.prod
# - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DEPLOY_SSH_KEY –¥–ª—è SSH-–¥–æ—Å—Ç—É–ø–∞
# - –°–º. docs/GITHUB_SECRETS_SETUP.md –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

# 2. –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ push –≤ main)
git push origin main

# 3. –ò–ª–∏ —Ä—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
./scripts/deploy_production.sh --version main

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
./scripts/health_check.sh --url https://bibliaris.com
```

### –†–∞–±–æ—Ç–∞—é—â–∏–µ Production URL

- **API Health**: https://bibliaris.com/api/health/liveness
- **Database Check**: https://bibliaris.com/api/health/readiness
- **Metrics**: https://bibliaris.com/api/metrics
- **API Docs**: https://bibliaris.com/docs

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –¥–µ–ø–ª–æ—è

- **üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞** - Docker, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **üîÑ CI/CD Pipeline** - GitHub Actions —Å —Ç–µ—Å—Ç–∞–º–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –¥–µ–ø–ª–æ–µ–º
- **üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - SSH, Firewall, SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, Rate limiting
- **üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - Prometheus + Grafana + AlertManager
- **üíæ –ë—ç–∫–∞–ø—ã** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã PostgreSQL —Å —Ä–æ—Ç–∞—Ü–∏–µ–π
- **ü©∫ Health Checks** - 8+ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
- **‚è™ –û—Ç–∫–∞—Ç** - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π rollback –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–µ–ø–ª–æ—è

- **üìã [–ß–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è](docs/DEPLOYMENT_CHECKLIST.md)** - 22 —ç—Ç–∞–ø–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ production
- **üìñ [–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ](docs/PRODUCTION_DEPLOYMENT_GUIDE.md)** - –ø–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è
- **üèóÔ∏è [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ](docs/DEPLOYMENT.md)** - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
- **üîß [–°—Ç–∞—Ç—É—Å –∏—Ç–µ—Ä–∞—Ü–∏–π](docs/NEXT_STEPS_DEPLOYMENT.md)** - –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –ø–ª–∞–Ω—ã

### VS Code –∑–∞–¥–∞—á–∏ –¥–ª—è –¥–µ–ø–ª–æ—è

- `deploy:setup-server` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ production —Å–µ—Ä–≤–µ—Ä–∞ (dry-run)
- `deploy:production` ‚Äî –¥–µ–ø–ª–æ–π –≤ production (dry-run)
- `deploy:rollback` ‚Äî –æ—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ (dry-run)
- `health:check:local` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ API
- `health:check:prod` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ production API

### –ü—Ä–æ–¥–∞–∫—à–Ω-—Å–±–æ—Ä–∫–∞: Dockerfile + docker-compose.prod.yml

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–¥–∞–∫—à–Ω Dockerfile (multi-stage) –∏ compose –¥–ª—è –±–ª–∏–∑–∫–æ–≥–æ –∫ –ø—Ä–æ–¥ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- `Dockerfile` ‚Äî multi-stage: builder (yarn build, prisma generate) ‚Üí runner (NODE_ENV=production, —Ç–æ–ª—å–∫–æ prod-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏). –ù–∞ —Å—Ç–∞—Ä—Ç–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç `scripts/docker-entrypoint.sh` (–≤—ã–ø–æ–ª–Ω—è–µ—Ç `prisma migrate deploy`, –∑–∞—Ç–µ–º `node dist/main.js`).
- `docker-compose.prod.yml` ‚Äî —Å–µ—Ä–≤–∏—Å—ã `app` –∏ `postgres`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç 5000 –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env`.

–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ, production-—Ä–µ–∂–∏–º):

```bash
# –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å (profile prod)
docker compose --profile prod -f docker-compose.prod.yml up -d --build

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker compose --profile prod -f docker-compose.prod.yml logs -f app
```

–ü–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è:

- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ `.env` (DATABASE_URL –∏ –¥—Ä.). –î–ª—è prod —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–¥–∞—Ç—å `CORS_ORIGIN`, `LOCAL_PUBLIC_BASE_URL`.
- Migrate deploy –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω `prisma` –≤ `node_modules/.bin`.
- –î–ª—è lean-–æ–±—Ä–∞–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `.dockerignore` (–∏—Å–∫–ª—é—á–µ–Ω—ã node_modules, dist, —Ç–µ—Å—Ç—ã, docs –∏ –ø—Ä.).
- –ü–æ—Ä—Ç –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ë–î –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã: `PORT`, `POSTGRES_*`.

VS Code –∑–∞–¥–∞—á–∏ (Docker prod):

- `docker:build:prod` ‚Äî —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ –ø–æ `docker-compose.prod.yml` (—Å profile `prod`).
- `docker:up:prod` ‚Äî –∑–∞–ø—É—Å–∫ prod‚Äë—Å–≤—è–∑–∫–∏ –≤ —Ñ–æ–Ω–µ.
- `docker:down:prod` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∫–∞.
- `docker:logs:prod` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- `docker:tag:prod` ‚Äî —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç env `REGISTRY` –∏ `IMAGE_TAG` (–¥–µ—Ñ–æ–ª—Ç: `localhost` –∏ `latest`).
- `docker:push:prod` ‚Äî –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞ –≤ —Ä–µ–µ—Å—Ç—Ä.

–í `docker-compose.prod.yml` –¥–æ–±–∞–≤–ª–µ–Ω healthcheck –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ `app` (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç `GET /metrics`). Compose –∏—Å–ø–æ–ª—å–∑—É–µ—Ç profile `prod` (–∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Ñ–ª–∞–≥–æ–º `--profile prod`).

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (CORS, Swagger, Proxy)

- CORS:
  - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `CORS_ORIGIN` (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é), `CORS_CREDENTIALS` (0/1).
  - –î–ª—è prod –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤ –∏ –≤–∫–ª—é—á–∞–π—Ç–µ `CORS_CREDENTIALS=1` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω—ã cookie/withCredentials.
- Swagger:
  - **Swagger –≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω** –Ω–∞ `/docs`, OpenAPI —Å—Ö–µ–º–∞ –Ω–∞ `/docs-json`.
  - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞—â–∏—â–∞—Ç—å Swagger –≤ production —Å –ø–æ–º–æ—â—å—é reverse proxy/firewall –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
  - **–î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: [docs/AI_AGENT_FRONTEND_GUIDE.md](docs/AI_AGENT_FRONTEND_GUIDE.md)
  - **–î–ª—è production**: [docs/SWAGGER_ON_PRODUCTION.md](docs/SWAGGER_ON_PRODUCTION.md)
- Reverse proxy:
  - –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –∑–∞ –ø—Ä–æ–∫—Å–∏ (ingress), –≤–∫–ª—é—á–∏—Ç–µ `TRUST_PROXY=1`, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å X-Forwarded-\* –∑–∞–≥–æ–ª–æ–≤–∫–∏.

### –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ç—Ä–æ—Ç—Ç–ª–∏–Ω–≥

- –í–∫–ª—é—á–µ–Ω–∏–µ: `RATE_LIMIT_GLOBAL_ENABLED=1`.
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `RATE_LIMIT_GLOBAL_MAX` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100), `RATE_LIMIT_GLOBAL_WINDOW_MS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60000).
- –ò—Å–∫–ª—é—á–µ–Ω–∏—è: `/health`, `/metrics`, `/docs`, `/docs-json` (–Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç—Å—è).

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è OpenAPI —Ç–∏–ø–æ–≤ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

- –°–∫—Ä–∏–ø—Ç—ã:
  - `yarn openapi:types` ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–∏–ø—ã –≤ `libs/api-client/types.ts` –∏–∑ `http://localhost:5000/docs-json`.
  - `OPENAPI_URL=... yarn openapi:types` ‚Äî —É–∫–∞–∑–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π URL —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏.
  - `yarn openapi:types:prod` ‚Äî shortcut –¥–ª—è –ø—Ä–æ–¥-URL (`https://api.bibliaris.com/docs-json`).
- –ó–∞—á–µ–º: –µ–¥–∏–Ω—ã–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –¥–ª—è FE, –±–µ–∑ —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.
- –î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ SDK (axios/fetch + —Ö—É–∫–∏) –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å orval –∏–ª–∏ openapi-generator (—Å–º. docs/ITERATION_TASKS.md).
  - –î–ª—è RTK Query –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@rtk-query/codegen-openapi` –≤ —Ñ—Ä–æ–Ω—Ç–æ–≤–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, —á—Ç–æ–±—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å endpoints –ø—Ä—è–º–æ –≤ `createApi`.

### VS Code Dev Container (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `.devcontainer/` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â–∏–π `docker-compose.yml` –¥–ª—è Postgres/Redis –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π `docker-compose.devcontainer.yml` —Å `app` —Å–µ—Ä–≤–∏—Å–æ–º –Ω–∞ Node 22.
- –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É –≤ VS Code ‚Üí ¬´Reopen in Container¬ª. –ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è `yarn && yarn prisma:generate`.
- –ü–æ—Ä—Ç—ã 5000/5432/6379 –ø—Ä–æ–±—Ä–æ—à–µ–Ω—ã –Ω–∞—Ä—É–∂—É; —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –º–∞—É–Ω—Ç–∏—Ç—Å—è –∫–∞–∫ volume.

### Makefile –∞–ª–∏–∞—Å—ã

–î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ç–∏–ø–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –¥–æ–±–∞–≤–ª–µ–Ω `Makefile`:

```bash
make up           # docker compose up -d
make down         # docker compose down
make logs         # –ª–æ–≥–∏ compose
make ps           # —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
make migrate      # yarn prisma:migrate
make generate     # yarn prisma:generate
make seed         # yarn prisma:seed
make dev          # yarn start:dev
make reset        # npx prisma migrate reset --force (—É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ!)
make prisma-studio# yarn prisma:studio
make lint         # yarn lint
make typecheck    # yarn typecheck
make e2e          # yarn test:e2e
make e2e-serial   # yarn test:e2e:serial
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–¥–∞—Ç—å:

- DATABASE_URL ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL (–Ω–∞–ø—Ä–∏–º–µ—Ä, `postgresql://user:pass@localhost:5432/books?schema=public`)

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (–∏–º–µ—é—Ç –¥–µ—Ñ–æ–ª—Ç—ã –≤ –∫–æ–¥–µ):

- PORT ‚Äî –ø–æ—Ä—Ç HTTP-—Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5000)
- HOST ‚Äî –∞–¥—Ä–µ—Å –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.0.0.0)
- DEFAULT_LANGUAGE ‚Äî —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è i18n-–ø–æ–ª–∏—Ç–∏–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `en`)
- LOCAL_UPLOADS_DIR ‚Äî –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `var/uploads`)
- LOCAL_PUBLIC_BASE_URL ‚Äî –±–∞–∑–æ–≤—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫. –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `http://localhost:3000` –≤ SEO/Sitemap, –∏ `http://localhost:5000/static` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ç–æ—Ä–∞–¥–∂–∞. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è dev —Å—Ç–∞–≤–∏—Ç—å `http://localhost:5000/static`.
- CORS_ORIGIN ‚Äî —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–π Origin –¥–ª—è CORS (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `*`).
- BODY_LIMIT_JSON ‚Äî –ª–∏–º–∏—Ç –¥–ª—è JSON-—Ç–µ–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `1mb`).
- BODY_LIMIT_URLENCODED ‚Äî –ª–∏–º–∏—Ç –¥–ª—è urlencoded-—Ç–µ–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `1mb`).
- UPLOADS_MAX_IMAGE_MB ‚Äî –ª–∏–º–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ú–ë (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
- UPLOADS_MAX_AUDIO_MB ‚Äî –ª–∏–º–∏—Ç –∞—É–¥–∏–æ –≤ –ú–ë (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100)
- UPLOADS_PRESIGN_TTL_SEC ‚Äî TTL –¥–ª—è presign (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 600)
- UPLOADS_ALLOWED_IMAGE_CT ‚Äî —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö content-type –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `image/jpeg,image/png,image/webp`)
- UPLOADS_ALLOWED_AUDIO_CT ‚Äî —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö content-type –∞—É–¥–∏–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `audio/mpeg,audio/mp4,audio/aac,audio/ogg`)
- SITEMAP_CACHE_TTL_MS ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ sitemap/robots (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60000)
- SEO_CACHE_TTL_MS ‚Äî –∫—ç—à SEO-–±–∞–Ω–¥–ª–∞ (–æ–ø—Ü., –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ)
- VIEWS_CACHE_TTL_MS ‚Äî –∫—ç—à –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30000)
- RATE_LIMIT_ENABLED ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ (0/1)
- RATE_LIMIT_COMMENTS_PER_MINUTE ‚Äî –ª–∏–º–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∑–∞ –æ–∫–Ω–æ (–¥–µ—Ñ–æ–ª—Ç 10)
- RATE_LIMIT_COMMENTS_WINDOW_MS ‚Äî —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –¥–ª—è –ª–∏–º–∏—Ç–∞ (–¥–µ—Ñ–æ–ª—Ç 60000)
- ADMIN_EMAILS ‚Äî —Å–ø–∏—Å–æ–∫ email —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –¥–ª—è –∞–≤—Ç–æ-–≤—ã–¥–∞—á–∏ —Ä–æ–ª–∏ admin (–Ω–∞–ø—Ä–∏–º–µ—Ä, `admin@example.com`)
- CONTENT_MANAGER_EMAILS ‚Äî —Å–ø–∏—Å–æ–∫ email —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –¥–ª—è –∞–≤—Ç–æ-–≤—ã–¥–∞—á–∏ —Ä–æ–ª–∏ content_manager

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: Helmet, CORS –∏ –ª–∏–º–∏—Ç—ã —Ç–µ–ª–∞

–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤–∫–ª—é—á–µ–Ω—ã –±–∞–∑–æ–≤—ã–µ –∑–∞—â–∏—Ç—ã –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –ª–∏–º–∏—Ç—ã:

- Helmet —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (–≤ dev –æ—Ç–∫–ª—é—á—ë–Ω CSP, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å Swagger).
- CORS: `CORS_ORIGIN` (—Å—Ç—Ä–æ–∫–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `*`), –º–µ—Ç–æ–¥—ã/–∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –ø–æ —Å–ø–∏—Å–∫—É; –ø–æ–¥–¥–µ—Ä–∂–∞–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ `X-Admin-Language` –∏ `Accept-Language`.
- –õ–∏–º–∏—Ç—ã —Ç–µ–ª–∞: JSON –∏ URL-encoded –ø–æ 1 –ú–ë –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ `BODY_LIMIT_JSON` –∏ `BODY_LIMIT_URLENCODED`.
- –û—Ç–¥–µ–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –ø—Ä—è–º—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ¬´—Å—ã—Ä–æ–µ¬ª —Ç–µ–ª–æ –¥–æ ~110 –ú–ë: `POST /api/uploads/direct`.

## Shared modules: Prisma/Security

–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –µ—Å—Ç—å –¥–≤–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö ¬´shared¬ª –º–æ–¥—É–ª—è, —É–ø—Ä–æ—â–∞—é—â–∏—Ö DI –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ë–î:

- `PrismaModule` (`src/shared/prisma/prisma.module.ts`) ‚Äî –ø–æ–º–µ—á–µ–Ω `@Global()`, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `PrismaService`. –î–æ—Å—Ç—É–ø–µ–Ω –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö –±–µ–∑ —è–≤–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ —Å–µ—Ä–≤–∏—Å–∞.
- `SecurityModule` (`src/shared/security/security.module.ts`) ‚Äî –ø–æ–º–µ—á–µ–Ω `@Global()`, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `PrismaModule`, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `RolesGuard` –∏ `JwtAuthGuard` –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è.

–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö:

```ts
import { UseGuards } from '@nestjs/common';
import { Roles } from '../common/decorators/roles.decorator';
import { RolesGuard } from '../common/guards/roles.guard';
import { JwtAuthGuard } from '../common/guards/jwt-auth.guard';

@UseGuards(JwtAuthGuard, RolesGuard)
@Roles('admin') // –∏–ª–∏ Role.Admin –∏–∑ enum
```

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:

- –ì–≤–∞—Ä–¥—ã –ù–ï –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `APP_GUARD`, —á—Ç–æ–±—ã –ø—É–±–ª–∏—á–Ω—ã–µ —Ä—É—á–∫–∏ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ `@UseGuards` –Ω–∞ –Ω—É–∂–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö/–º–µ—Ç–æ–¥–∞—Ö.
- –†–∞–Ω–µ–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã `RolesGuard`/`PrismaService` –∏–∑ –º–æ–¥—É–ª–µ–π —É–¥–∞–ª–µ–Ω—ã ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ shared‚Äë–º–æ–¥—É–ª–∏. –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç —Ü–∏–∫–ª—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —É–ø—Ä–æ—â–∞–µ—Ç e2e.

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: Prometheus –º–µ—Ç—Ä–∏–∫–∏

- –≠–Ω–¥–ø–æ–∏–Ω—Ç: `GET /metrics` ‚Äî —Ç–µ–∫—Å—Ç–æ–≤–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus (content-type `text/plain; version=0.0.4`).
- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
  - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ (`collectDefaultMetrics` –∏–∑ `prom-client`).
  - –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ `http_request_duration_seconds{method,route,status_code}` –¥–ª—è –≤—Å–µ—Ö HTTP‚Äë–∑–∞–ø—Ä–æ—Å–æ–≤ (–≥–ª–æ–±–∞–ª—å–Ω—ã–π interceptor).
- –ù–∞ dev –Ω–µ –∑–∞—â–∏—â–µ–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π. –î–ª—è prod –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ CIDR –≤ –±—É–¥—É—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö.

–°–º. `src/common/security/app-security.config.ts` –∏ `src/main.ts` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è.

## –Ø–∑—ã–∫–∏: –ø–æ–ª–∏—Ç–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏ –∑–∞–¥–∞—é—Ç—Å—è Prisma enum `Language` (en, es, fr, pt). –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–µ–π Prisma (—Å–º. ADR –Ω–∏–∂–µ).
- –†–µ–∂–∏–º –º—É–ª—å—Ç–∏—Å–∞–π—Ç–∞: –ø—É–±–ª–∏—á–Ω—ã–µ URL –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å —è–∑—ã–∫–∞ `/:lang` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/en/book/...`). –Ø–∑—ã–∫ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –ø—É—Ç–∏ –∏ –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ `?lang` –∏ `Accept-Language`.
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: `?lang` –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Accept-Language` –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ fallback.
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
  - –†–µ–∑–æ–ª–≤–µ—Ä —è–∑—ã–∫–∞ –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –ø—É—Ç–∏ (request-scoped –∫–æ–Ω—Ç–µ–∫—Å—Ç) + —É—Ç–∏–ª–∏—Ç–∞ `src/shared/language/language.util.ts` –¥–ª—è fallback.
  - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ –ø—É–±–ª–∏—á–Ω—ã—Ö —Ä—É—á–∫–∞—Ö: `GET /:lang/books/:slug/overview`, `GET /:lang/categories/:slug/books`, `GET /:lang/tags/:slug/books`, `GET /:lang/books/:bookId/versions`.
  - –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–π/—Ç–µ–≥–æ–≤: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã legacy-–º–∞—Ä—à—Ä—É—Ç—ã –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ —è–∑—ã–∫–∞ ‚Äî `GET /categories/:slug/books` –∏ `GET /tags/:slug/books`. –û–Ω–∏ –≤—ã–±–∏—Ä–∞—é—Ç —è–∑—ã–∫ –ø–æ `?lang` (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ) –∏–ª–∏ `Accept-Language` –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `availableLanguages`.
- E2E: –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º —è–∑—ã–∫–∞; —Ç–µ—Å—Ç—ã –ø—Ä–∏–æ—Ä–∏—Ç–µ–∑–∞—Ü–∏–∏ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –Ω–∞–¥ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏.

  ### SEO resolve –∏ i18n
  - –ü—É–±–ª–∏—á–Ω—ã–µ —Ä–µ–∑–æ–ª–≤–µ—Ä—ã SEO —É—á–∏—Ç—ã–≤–∞—é—Ç —è–∑—ã–∫:
    - `GET /seo/resolve?type=book|version|page&id=...&lang=xx` + –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Accept-Language`.
    - `GET /:lang/seo/resolve?type=...&id=...` ‚Äî —è–∑—ã–∫ –ø—É—Ç–∏ –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ query/header.
  - –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π URL:
    - –î–ª—è `version` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞: `/versions/:id`.
    - –î–ª—è `book`/`page` –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å —è–∑—ã–∫–∞: `/:lang/books/:slug`, `/:lang/pages/:slug`.

ADR: —Å–º. `docs/adr/2025-08-26-language-policy-and-extensibility.md` ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ —Ä–µ—à–µ–Ω–∏–µ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞ Prisma enum, –ø–æ–∫–∞ –Ω–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º —è–∑—ã–∫–æ–≤ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É.
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: `docs/adr/2025-08-29-multisite-i18n.md` –∏ `docs/MULTISITE_I18N.md` ‚Äî —Ä–µ—à–µ–Ω–∏–µ –æ –º—É–ª—å—Ç–∏—Å–∞–π—Ç–µ –∏ –ø–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è.

–ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

- –ü–æ–ª–∏—Ç–∏–∫–∞ URL –¥–ª—è i18n –∏ ¬´–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã—Ö¬ª API: —Å–º. —Ä–∞–∑–¥–µ–ª ¬´–ü–æ–ª–∏—Ç–∏–∫–∞ URL –¥–ª—è i18n –∏ ¬´–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã—Ö¬ª API (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ)¬ª –≤ `docs/MULTISITE_I18N.md`.

### –ê–¥–º–∏–Ω-–∫–æ–Ω—Ç–µ–∫—Å—Ç —è–∑—ã–∫–∞

- –ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ. –ù–∞ –±—ç–∫–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø—Ä–µ—Ñ–∏–∫—Å `/admin/:lang` –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Admin-Language` (–∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ —è–∑—ã–∫–æ–º –ø—É—Ç–∏).
- –õ–∏—Å—Ç–∏–Ω–≥–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —è–∑—ã–∫: Pages (`GET/POST /admin/:lang/pages`), BookVersions (`GET/POST /admin/:lang/books/:bookId/versions`).
- –í DTO —Å–æ–∑–¥–∞–Ω–∏–µ Page/BookVersion –ø–æ–ª–µ `language` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–±–µ—Ä—ë—Ç—Å—è –∏–∑ –∞–¥–º–∏–Ω-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞) ‚Äî –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

## Compile and run the project

```bash
# development
$ yarn run start

# watch mode
$ yarn run start:dev

# production mode
$ yarn run start:prod
```

## Run tests

```bash
# unit tests
$ yarn run test

# e2e tests
$ yarn run test:e2e

# test coverage
$ yarn run test:cov
```

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ —é–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç–∞–º:

- –Æ–Ω–∏—Ç‚Äë—Å—å—é—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –±–µ–∑ –ë–î/Redis; –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Prisma/Storage/Jwt/Config) –º–æ–∫–∏—Ä—É—é—Ç—Å—è.
- –ü–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω –ø–æ–∫—Ä—ã—Ç–∏—è –∏ —Å—Ç–∞—Ç—É—Å –∏—Ç–µ—Ä–∞—Ü–∏–π ‚Äî –≤ `docs/UNIT_TESTING_PLAN.md`.

–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (2025-09-06): —Ä–∞—Å—à–∏—Ä–µ–Ω—ã –∫–µ–π—Å—ã —é–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç–æ–≤

- AuthService: refresh ‚Äî –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π/–ø—Ä–æ—Ç—É—Ö—à–∏–π —Ç–æ–∫–µ–Ω ‚Üí Unauthorized; logout ‚Üí success=true.
- UsersService: assignRole/revokeRole ‚Äî NotFound –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/—Ä–æ–ª–∏; list ‚Äî –ø–∞–≥–∏–Ω–∞—Ü–∏—è –∏ staff=exclude.
- ViewStatsService: aggregate/top ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ source; –≤–∞–ª–∏–¥–∞—Ü–∏—è from>to; –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ.

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ —Ç–µ—Å—Ç–∞–º:

- –Æ–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç—ã: `yarn test`.
- E2E‚Äë—Ç–µ—Å—Ç—ã: `yarn test:e2e` (–≤ dev –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏).
- –ó–∞–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ e2e-—Ñ–∞–π–ª–∞:

```bash
yarn test:e2e -- tags.e2e-spec.ts
```

### –¢–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (.env.test)

- –î–ª—è e2e –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ë–î, —Å–æ–∑–¥–∞–≤–∞–µ–º–∞—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `DATABASE_URL` –∏–∑ `.env`.
- –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∏–º–µ—Ä `.env.test.example` ‚Äî –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ `.env.test` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- –°–∫—Ä–∏–ø—Ç—ã e2e (test/setup-e2e.ts, test/teardown-e2e.ts) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Å—Ç–∞–≤–ª—è—é—Ç —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `PRISMA_TEST_DB_NAME` –∏ `PRISMA_TEST_ADMIN_URL` –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∏—Ö —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏.

## VS Code –∑–∞–¥–∞—á–∏

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∑–∞–¥–∞—á–∏ VS Code –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–∏–ø–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: `.vscode/tasks.json`.

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–¥–∞—á–∏:

- dev ‚Äî `yarn start:dev` (—Ñ–æ–Ω)
- lint ‚Äî `yarn lint` (—Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ `$eslint-stylish`)
- typecheck ‚Äî `yarn typecheck` (—Å `$tsc` problem matcher)
- test:e2e ‚Äî `yarn test:e2e`
- test:e2e:serial ‚Äî `yarn test:e2e:serial`
- prisma:generate ‚Äî `yarn prisma:generate`
- prisma:migrate ‚Äî `yarn prisma:migrate`
- prisma:seed ‚Äî `yarn prisma:seed`
- prisma:studio ‚Äî `yarn prisma:studio` (—Ñ–æ–Ω)

- ci ‚Äî `yarn ci` (portable CI: install ‚Üí prisma generate ‚Üí lint ‚Üí typecheck ‚Üí unit ‚Üí (–æ–ø—Ü.) e2e ‚Üí build)

–ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å:

1. –û—Ç–∫—Ä–æ–π—Ç–µ VS Code ‚Üí Command Palette ‚Üí "Tasks: Run Task" ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É.
2. –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (`dev`, `prisma:studio`) –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Terminal ‚Üí Kill Task.

## CI (portable)

- –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä‚Äë–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π —Å–∫—Ä–∏–ø—Ç CI: `scripts/ci.sh`. –û–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π `yarn ci` –∏–ª–∏ —á–µ—Ä–µ–∑ Makefile `make ci`.
- –°–∫—Ä–∏–ø—Ç –≤–∫–ª—é—á–∞–µ—Ç: —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, `prisma:generate`, `lint`, `typecheck`, —é–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç—ã –∏ —Å–±–æ—Ä–∫—É. E2E –≤—ã–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- –ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å E2E –≤ CI (–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ –ø–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º CI), –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `CI_E2E=1` –∏ `DATABASE_URL` (–≤–∞–ª–∏–¥–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Postgres). –¢–æ–≥–¥–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω `yarn test:e2e:serial`.
- –®–∞–±–ª–æ–Ω—ã –∫–æ–Ω—Ñ–∏–≥–æ–≤ –ø–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –¥–ª—è –æ–±–æ–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
  - GitHub: `.github/workflows/ci.yml` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç `yarn ci`.
  - GitLab: `.gitlab-ci.yml` ‚Äî stage `ci`, —Ç–∞–∫–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç `yarn ci`.

## –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (/static) –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏

- –õ–æ–∫–∞–ª—å–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥ `LOCAL_UPLOADS_DIR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `var/uploads`).
- –§–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–¥–∞—é—Ç—Å—è –ø–æ –ø—É—Ç–∏ `/static`, –ø—Ä–∏–º–µ—Ä: `http://localhost:5000/static/<relative-path>`.
- –ü—Ä—è–º—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–ª–æ–∫–∞–ª—å–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä): POST `/api/uploads/direct` (–ª–∏–º–∏—Ç ~110 –ú–ë, —Å–º. `main.ts`).
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ Media Library:

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫: Sentry (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –∑–∞–¥–∞–Ω `SENTRY_DSN` (—Å–º. `.env.example`). –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –º–æ–∂–Ω–æ `SENTRY_ENABLED=0`.
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `SENTRY_ENV` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `NODE_ENV`), `SENTRY_RELEASE`, `SENTRY_TRACES_SAMPLE_RATE=0`, `SENTRY_PROFILES_SAMPLE_RATE=0`.
- –ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:
  - 5xx –æ—à–∏–±–∫–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞ (–º–µ—Ç–æ–¥, –ø—É—Ç—å/—Ä–æ—É—Ç, –∑–∞–≥–æ–ª–æ–≤–∫–∏, query, params; —Ç–µ–ª–æ ‚Äî —Å –º–∞—Å–∫–∏—Ä–æ–≤–∫–æ–π –ø–æ–ª–µ–π `password|token|authorization|secret|cookie`).
  - 4xx (400/401/403/404/429) ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è, —á—Ç–æ–±—ã –Ω–µ —à—É–º–µ—Ç—å.
- –¢–µ—Å—Ç —Ä—É—á–∫–∞: `POST /api/status/sentry-test` ‚Äî —Ç—Ä–µ–±—É–µ—Ç Auth + —Ä–æ–ª—å Admin; –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 500 –∏ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º Sentry —Å–æ–∑–¥–∞—ë—Ç —Å–æ–±—ã—Ç–∏–µ.
  - POST `/media/confirm` ‚Äî —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å `MediaAsset` –ø–æ `key` (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ);
  - GET `/media` ‚Äî –ø–æ–∏—Å–∫/–ª–∏—Å—Ç–∏–Ω–≥ –ø–æ `q` –∏ `type`;
  - DELETE `/media/:id` ‚Äî –º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ.

## Dev-–≤–æ—Ä–∫—Ñ–ª–æ—É: pre-commit (Husky + lint-staged)

- –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω pre-commit —Ö—É–∫ Husky, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
  - `lint-staged` –¥–ª—è –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (`eslint --fix` –∏ `prettier --write` –¥–ª—è `*.{ts,tsx,js}`; `prettier --write` –¥–ª—è `*.{md,yml,yaml,json}`).
  - –ë—ã—Å—Ç—Ä—ã–π —Ç–∏–ø–æ–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å: `yarn typecheck` (`tsc --noEmit`).
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è:
  - Husky –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `"prepare": "husky && chmod +x .husky/pre-commit || true"` –ø—Ä–∏ `yarn`.
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ Yarn (classic). npm –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.
- –û–±—Ö–æ–¥/–ø–æ—á–∏–Ω–∫–∞:
  - –í —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö—É–∫: `git commit -m "msg" --no-verify` (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è).
  - –ï—Å–ª–∏ —Ö—É–∫ –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑-–∑–∞ –ø—Ä–∞–≤, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: `chmod +x .husky/pre-commit`.

## Deployment

When you're ready to deploy your NestJS application to production, there are some key steps you can take to ensure it runs as efficiently as possible. Check out the [deployment documentation](https://docs.nestjs.com/deployment) for more information.

If you are looking for a cloud-based platform to deploy your NestJS application, check out [Mau](https://mau.nestjs.com), our official platform for deploying NestJS applications on AWS. Mau makes deployment straightforward and fast, requiring just a few simple steps:

```bash
$ yarn install -g @nestjs/mau
$ mau deploy
```

With Mau, you can deploy your application in just a few clicks, allowing you to focus on building features rather than managing infrastructure.

## Resources

Check out a few resources that may come in handy when working with NestJS:

- Visit the [NestJS Documentation](https://docs.nestjs.com) to learn more about the framework.
- For questions and support, please visit our [Discord channel](https://discord.gg/G7Qnnhy).
- To dive deeper and get more hands-on experience, check out our official video [courses](https://courses.nestjs.com/).
- Deploy your application to AWS with the help of [NestJS Mau](https://mau.nestjs.com) in just a few clicks.
- Visualize your application graph and interact with the NestJS application in real-time using [NestJS Devtools](https://devtools.nestjs.com).
- Need help with your project (part-time to full-time)? Check out our official [enterprise support](https://enterprise.nestjs.com).
- To stay in the loop and get updates, follow us on [X](https://x.com/nestframework) and [LinkedIn](https://linkedin.com/company/nestjs).
- Looking for a job, or have a job to offer? Check out our official [Jobs board](https://jobs.nestjs.com).

## Support

Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).

## Stay in touch

- Author - [Kamil My≈õliwiec](https://twitter.com/kammysliwiec)
- Website - [https://nestjs.com](https://nestjs.com/)
- Twitter - [@nestframework](https://twitter.com/nestframework)

## License

Nest is [MIT licensed](https://github.com/nestjs/nest/blob/master/LICENSE).

# Books App Back

## Slug –≤–∞–ª–∏–¥–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ–º –µ–¥–∏–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è slug'–æ–≤ –∫–Ω–∏–≥/–∫–∞—Ç–µ–≥–æ—Ä–∏–π:

–ü–∞—Ç—Ç–µ—Ä–Ω (RegExp): `^[a-z0-9]+(?:-[a-z0-9]+)*$`

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

- –¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ –∏ —Ü–∏—Ñ—Ä—ã
- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å ‚Äî –¥–µ—Ñ–∏—Å `-`
- –ë–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤, –±–µ–∑ –¥–≤–æ–π–Ω—ã—Ö/–∫—Ä–∞–π–Ω–∏—Ö –¥–µ—Ñ–∏—Å–æ–≤

–ü—Ä–∏–º–µ—Ä—ã:

- –î–æ–ø—É—Å—Ç–∏–º–æ: `harry-potter`, `book-123`, `a1-b2-c3`
- –ù–µ–¥–æ–ø—É—Å—Ç–∏–º–æ: `Harry-Potter` (–ø—Ä–æ–ø–∏—Å–Ω—ã–µ), `book__123` (–ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è), `book--123` (–¥–≤–æ–π–Ω–æ–π –¥–µ—Ñ–∏—Å), `-abc` –∏–ª–∏ `abc-` (–∫—Ä–∞–π–Ω–∏–µ –¥–µ—Ñ–∏—Å—ã)

–ü–æ–¥—Å–∫–∞–∑–∫–∞: –≤ DTO –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `SLUG_PATTERN` –∏ `SLUG_REGEX` –∏–∑ `src/shared/validators/slug.ts`; —Å–æ–æ–±—â–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ `SLUG_REGEX_README`.

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏

- Sitemap/Robots per-language

–î–æ–±–∞–≤–ª–µ–Ω—ã SEO-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∫–∞—Ä—Ç —Å–∞–π—Ç–∞ –∏ robots.txt —Å —É—á—ë—Ç–æ–º —è–∑—ã–∫–æ–≤—ã—Ö –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤:

- GET /api/sitemap.xml ‚Äî –∏–Ω–¥–µ–∫—Å, —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ per-language –∫–∞—Ä—Ç—ã (`/sitemap-en.xml`, `/sitemap-es.xml`, ...)
- GET /api/sitemap-:lang.xml ‚Äî –∫–∞—Ä—Ç–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —è–∑—ã–∫–∞; URL –≤–∫–ª—é—á–∞—é—Ç `/:lang` –ø—Ä–µ—Ñ–∏–∫—Å (–∫–Ω–∏–≥–∏ –∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
- GET /api/robots.txt ‚Äî –±–∞–∑–æ–≤—ã–π robots —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ `/sitemap.xml`

–ù–∞—Å—Ç—Ä–æ–π–∫–∏:

- LOCAL_PUBLIC_BASE_URL ‚Äî –±–∞–∑–æ–≤—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é http://localhost:3000)
- SITEMAP_CACHE_TTL_MS ‚Äî TTL –∫—ç—à–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ sitemap/robots (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60000 –º—Å)

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≤–µ—Ä—Å–∏–∏ –∫–Ω–∏–≥ `/versions/:id` –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ sitemap; –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ –ø—É–±–ª–∏—á–Ω—ã–µ URL —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∫–Ω–∏–≥/—Å—Ç—Ä–∞–Ω–∏—Ü —Å —è–∑—ã–∫–æ–≤—ã–º –ø—Ä–µ—Ñ–∏–∫—Å–æ–º.

–ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: CRUD –∏ –ø—Ä–∏–≤—è–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∫ –≤–µ—Ä—Å–∏—è–º –∫–Ω–∏–≥. –¢–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π (—Ä–æ–¥–∏—Ç–µ–ª—å/–¥–µ—Ç–∏). –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–≤–æ–¥—ã CategoryTranslation.

- POST /categories ‚Äî —Å–æ–∑–¥–∞—Ç—å (admin|content_manager)
- PATCH /categories/:id ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å (admin|content_manager)
- DELETE /categories/:id ‚Äî —É–¥–∞–ª–∏—Ç—å (admin|content_manager)
- GET /categories ‚Äî —Å–ø–∏—Å–æ–∫
- GET /:lang/categories/:slug/books ‚Äî –≤–µ—Ä—Å–∏–∏ –ø–æ —Å–ª–∞–≥—É –ø–µ—Ä–µ–≤–æ–¥–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—è–∑—ã–∫ –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞); —Ç–∞–∫–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç availableLanguages
- GET /categories/:id/children ‚Äî –ø—Ä—è–º—ã–µ –¥–æ—á–µ—Ä–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- GET /categories/tree ‚Äî –ø–æ–ª–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- GET /categories/:id/translations ‚Äî —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (admin|content_manager)
- POST /categories/:id/translations ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥ (admin|content_manager)
- PATCH /categories/:id/translations/:language ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ (admin|content_manager)
- DELETE /categories/:id/translations/:language ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ (admin|content_manager)

–ü—Ä–∏–≤—è–∑–∫–∞ –∫ –≤–µ—Ä—Å–∏—è–º:

- POST /versions/:id/categories ‚Äî –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫ –≤–µ—Ä—Å–∏–∏
- DELETE /versions/:id/categories/:categoryId ‚Äî –æ—Ç–≤—è–∑–∞—Ç—å

–ü—Ä–∞–≤–∏–ª–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è:

- –ü–æ–ª–µ parentId –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ; —á—Ç–æ–±—ã —Å–Ω—è—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è, –ø–µ—Ä–µ–¥–∞–π—Ç–µ `parentId: null` –≤ PATCH.
- –ó–∞–ø—Ä–µ—â–µ–Ω—ã —Ü–∏–∫–ª—ã –∏ —Å–∞–º–æ–ø—Ä–∏–≤—è–∑–∫–∞ (`parentId != id`).
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –µ—Å–ª–∏ —É –Ω–µ—ë –µ—Å—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

Swagger —Å—Ö–µ–º—ã:

- –î–µ—Ä–µ–≤–æ –∏ —Å–ø–∏—Å–æ–∫ –¥–µ—Ç–µ–π –æ–ø–∏—Å–∞–Ω—ã —á–µ—Ä–µ–∑ –æ–±—â–∏–π DTO `CategoryTreeNodeDto` (—Å–º. `src/modules/category/dto/category-tree-node.dto.ts`).
- –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:
  - `GET /categories/tree` ‚Üí `[CategoryTreeNodeDto]`
  - `GET /categories/:id/children` ‚Üí `[CategoryTreeNodeDto]`

  ## –¢–µ–≥–∏

  –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: CRUD –∏ –ø—Ä–∏–≤—è–∑–∫–∞ —Ç–µ–≥–æ–≤ –∫ –≤–µ—Ä—Å–∏—è–º –∫–Ω–∏–≥. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–≤–æ–¥—ã TagTranslation.
  - GET /tags ‚Äî —Å–ø–∏—Å–æ–∫ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç page, limit)
  - POST /tags ‚Äî —Å–æ–∑–¥–∞—Ç—å (admin|content_manager)
  - PATCH /tags/:id ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å (admin|content_manager)
  - DELETE /tags/:id ‚Äî —É–¥–∞–ª–∏—Ç—å (admin|content_manager)
  - GET /:lang/tags/:slug/books ‚Äî –≤–µ—Ä—Å–∏–∏ –ø–æ —Å–ª–∞–≥—É –ø–µ—Ä–µ–≤–æ–¥–∞ —Ç–µ–≥–∞ (—è–∑—ã–∫ –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞); –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∞–∫–∂–µ availableLanguages
  - GET /tags/:id/translations ‚Äî —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (admin|content_manager)
  - POST /tags/:id/translations ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥ (admin|content_manager)
  - PATCH /tags/:id/translations/:language ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ (admin|content_manager)
  - DELETE /tags/:id/translations/:language ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ (admin|content_manager)

  –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –≤–µ—Ä—Å–∏—è–º:
  - POST /versions/:id/tags ‚Äî –ø—Ä–∏–≤—è–∑–∞—Ç—å —Ç–µ–≥ –∫ –≤–µ—Ä—Å–∏–∏ (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ)
  - DELETE /versions/:id/tags/:tagId ‚Äî –æ—Ç–≤—è–∑–∞—Ç—å —Ç–µ–≥ –æ—Ç –≤–µ—Ä—Å–∏–∏ (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ)

  –ü—Ä–∞–≤–∏–ª–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è:
  - Slug –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º `^[a-z0-9]+(?:-[a-z0-9]+)*$` (—Å–º. `src/shared/validators/slug.ts`).

## Swagger

- –î–æ—Å—Ç—É–ø–Ω–æ –ø–æ `/docs` (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ `/api`).
- –°—Ö–µ–º—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö DTO –º–æ–¥—É–ª–µ–π (Books, Versions, Categories –≤ —Ç.—á. `CategoryTreeNodeDto`).
- JSON –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π: `/docs-json` (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ `/api`).
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: Swagger –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –î–û `setGlobalPrefix('api')`, –ø–æ—ç—Ç–æ–º—É –¥–æ—Å—Ç—É–ø–µ–Ω –±–µ–∑ `/api` –ø—Ä–µ—Ñ–∏–∫—Å–∞. –í—Å–µ API endpoints –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ `/api/*`.

## –ú–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞

- –ó–∞–≥—Ä—É–∑–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å Uploads: –ø—Ä–µ—Å–∞–π–Ω ‚Üí –ø—Ä—è–º–æ–π upload ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ `key` –∏ `publicUrl`.
- –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω –º–æ–¥—É–ª—å Media:
  - POST `/media/confirm` ‚Äî —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å `MediaAsset` –ø–æ `key` (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ).
  - GET `/media` ‚Äî –ª–∏—Å—Ç–∏–Ω–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ `q` (–ø–æ–¥—Å—Ç—Ä–æ–∫–∞ –ø–æ key/url) –∏ `type` (–ø—Ä–µ—Ñ–∏–∫—Å contentType), –ø–∞–≥–∏–Ω–∞—Ü–∏—è.
  - DELETE `/media/:id` ‚Äî –º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏ –ø–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞.
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–æ–ª–µ–π admin|content_manager.
- –ú–æ–¥–µ–ª—å `MediaAsset` –æ–ø–∏—Å–∞–Ω–∞ –≤ `prisma/schema.prisma` (—Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º e2e –¥–ª—è –º–µ–¥–∏–∞).

## Prisma

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞: `yarn prisma:generate`
- –ú–∏–≥—Ä–∞—Ü–∏–∏ (dev): `yarn prisma:migrate`
- –°–∏–¥—ã: `yarn prisma:seed`
- Studio: `yarn prisma:studio`

–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `DATABASE_URL` –≤ `.env`.

### –í–µ—Ä—Å–∏–∏ –∏ output Prisma Client

- Prisma CLI: 6.14.0
- @prisma/client: 6.14.0
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞: –≤ `prisma/schema.prisma` –∑–∞–¥–∞–Ω–æ `output = "../node_modules/.prisma/client"` (–ø—É—Ç—å —É–∫–∞–∑–∞–Ω –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ñ–∞–π–ª–∞ —Å—Ö–µ–º—ã). –í –∏—Ç–æ–≥–µ –∫–ª–∏–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –∫–æ—Ä–Ω–µ–≤–æ–π `./node_modules/.prisma/client`. –ò–º–ø–æ—Ä—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ—Å—Ç–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `@prisma/client`.

–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:

- –£—Å—Ç–æ–π—á–∏–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±—É–¥—É—â–∏–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ Prisma.
- –ò—Å–∫–ª—é—á–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤, –∞ —Ç–∞–∫–∂–µ —É–ø—Ä–æ—â–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CI.

### –¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥ –º–∏–≥—Ä–∞—Ü–∏–π (PostgreSQL)

–ï—Å–ª–∏ –ø—Ä–∏ `prisma migrate dev` / `prisma migrate status` –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤–∏–¥–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∏–Ω–¥–µ–∫—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Like_userId_commentId_key`), —ç—Ç–æ —á–∞—Å—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –≤ —Ä–∞–Ω–Ω–∏—Ö –º–∏–≥—Ä–∞—Ü–∏—è—Ö. –ü–æ–¥—Ö–æ–¥ –∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –Ω–∞ dev:

1. –°–¥–µ–ª–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º: –∑–∞–º–µ–Ω–∏—Ç—å `CREATE UNIQUE INDEX ...` –Ω–∞ `CREATE UNIQUE INDEX IF NOT EXISTS ...` –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –º–∏–≥—Ä–∞—Ü–∏—è—Ö.
2. –°–±—Ä–æ—Å–∏—Ç—å dev-–±–∞–∑—É –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏.
3. –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma Client.

–ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥:

```bash
# –í–ù–ò–ú–ê–ù–ò–ï: —É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ dev-–±–∞–∑–µ
npx prisma migrate reset --force

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ
yarn prisma:migrate
yarn prisma:generate
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

- **–ò—Ç–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–ª–∞–Ω:** `docs/ITERATION_TASKS.md`
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –ò–ò:** `docs/AGENT_CONTEXT.md`
- **–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞:** `docs/PROJECT_OVERVIEW.md`
- **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:** `CHANGELOG.md`

### Deployment –∏ Production

- **ÔøΩ –ß–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è:** `docs/DEPLOYMENT_CHECKLIST.md` - **–≥–ª–∞–≤–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç** (22 —ç—Ç–∞–ø–∞)
- **üìñ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ:** `docs/PRODUCTION_DEPLOYMENT_GUIDE.md` - **–ø–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ**
- **üèóÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ:** `docs/DEPLOYMENT.md` - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
- **‚úÖ –°—Ç–∞—Ç—É—Å –∏—Ç–µ—Ä–∞—Ü–∏–π:** `docs/NEXT_STEPS_DEPLOYMENT.md` - –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–µ–ø–ª–æ—è (–ó–ê–í–ï–†–®–ï–ù–û)
- **üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** `docs/SECURITY_GUIDE.md` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **üíæ –ë—ç–∫–∞–ø—ã:** `docs/BACKUP_GUIDE.md` - —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- **üîß Reverse Proxy:** `docs/REVERSE_PROXY_GUIDE.md` - Caddy —Å HTTPS
- **üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** `docs/MONITORING_GUIDE.md` - Prometheus + Grafana

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ URL:** `docs/API_URL_STRUCTURE.md` ‚≠ê - –ø–æ—á–µ–º—É `/docs` –±–µ–∑ `/api`
- **–Ø–∑—ã–∫–æ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞:** `docs/adr/2025-08-26-language-policy-and-extensibility.md`
- **–ú—É–ª—å—Ç–∏—Å–∞–π—Ç i18n:** `docs/adr/2025-08-29-multisite-i18n.md`
- **–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π:** `docs/adr/2025-08-25-category-hierarchy-strategy.md`

### –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–º—ã

- **API Endpoints:** `docs/ENDPOINTS.md`
- **–ú—É–ª—å—Ç–∏—Å–∞–π—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** `docs/MULTISITE_I18N.md`
- **–ú–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `docs/MEDIA_LIBRARY.md`
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** `docs/UNIT_TESTING_PLAN.md`

### Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- **ü§ñ AI Agent Guide:** `docs/AI_AGENT_FRONTEND_GUIDE.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è AI —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏—Ö —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- **Frontend Preparation:** `docs/ITERATION_8_FRONTEND_PREPARATION.md`

## –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤–µ—Ä—Å–∏–π (draft/published)

- –ù–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ –∫–Ω–∏–≥ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `draft`.
- –ü—É–±–ª–∏—á–Ω—ã–µ —Ä—É—á–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç–æ–ª—å–∫–æ `published` –≤–µ—Ä—Å–∏–∏.
- –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–º (—Ç—Ä–µ–±—É—é—Ç —Ä–æ–ª–∏ admin –∏–ª–∏ content_manager):
- `PATCH /versions/:id/publish` ‚Äî –ø—É–±–ª–∏–∫—É–µ—Ç –≤–µ—Ä—Å–∏—é, –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç `publishedAt`.
- `PATCH /versions/:id/unpublish` ‚Äî —Å–Ω–∏–º–∞–µ—Ç —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, `status=draft`, `publishedAt=null`.
- –õ–∏—Å—Ç–∏–Ω–≥–∏:
- –ü—É–±–ª–∏—á–Ω–æ: `GET /books/:bookId/versions` ‚Äî —Ç–æ–ª—å–∫–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ.
- –ê–¥–º–∏–Ω: `GET /admin/books/:bookId/versions` ‚Äî –≤–∫–ª—é—á–∞–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫–∏ (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Ä–æ–ª–µ–π).
- –¢–∞–∫–∂–µ –ø—É–±–ª–∏—á–Ω—ã–π –ª–∏—Å—Ç–∏–Ω–≥ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `includeDrafts=true`, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–æ–≤/–∫–æ–Ω—Ç–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤.

–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –ª–∏—Å—Ç–∏–Ω–≥–∞ –≤–µ—Ä—Å–∏–π (`GET /books/:bookId/versions`):

- –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `language` –Ω–µ —É–∫–∞–∑–∞–Ω, —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É `Accept-Language` ‚Üí `DEFAULT_LANGUAGE` ‚Üí –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π.
- –ï—Å–ª–∏ `?language=` –∑–∞–¥–∞–Ω —è–≤–Ω–æ, –æ–Ω –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `Accept-Language`.
- –ó–Ω–∞—á–µ–Ω–∏–µ `DEFAULT_LANGUAGE` –∑–∞–¥–∞—ë—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–º. `.env.example`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `en`).

–ü—Ä–∏–º–µ—Ä—ã (curl):

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–µ—Ä—Å–∏—é (draft)
curl -X POST \
 -H "Authorization: Bearer <ADMIN_ACCESS_TOKEN>" \
 -H "Content-Type: application/json" \
 -d '{
   "language":"en","title":"Title","author":"Author","description":"Desc",
   "coverImageUrl":"https://example.com/c.jpg","type":"text","isFree":true
 }' \
 http://localhost:3000/books/<BOOK_ID>/versions

# –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
curl -X PATCH -H "Authorization: Bearer <ADMIN_ACCESS_TOKEN>" \
 http://localhost:3000/versions/<VERSION_ID>/publish

# –°–Ω—è—Ç—å —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
curl -X PATCH -H "Authorization: Bearer <ADMIN_ACCESS_TOKEN>" \
 http://localhost:3000/versions/<VERSION_ID>/unpublish

# –ü—É–±–ª–∏—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ (—Ç–æ–ª—å–∫–æ published)
curl http://localhost:3000/books/<BOOK_ID>/versions

# –ü—É–±–ª–∏—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å –≤—ã–±–æ—Ä–æ–º —è–∑—ã–∫–∞ —á–µ—Ä–µ–∑ Accept-Language (–µ—Å–ª–∏ ?language –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω)
curl -H "Accept-Language: es-ES,fr;q=0.9,en;q=0.5" \
  http://localhost:3000/books/<BOOK_ID>/versions

# –Ø–≤–Ω—ã–π –≤—ã–±–æ—Ä —è–∑—ã–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ Accept-Language)
curl "http://localhost:3000/books/<BOOK_ID>/versions?language=fr"

# –ê–¥–º–∏–Ω—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ (–≤–∫–ª—é—á–∞—è draft)
curl -H "Authorization: Bearer <ADMIN_ACCESS_TOKEN>" \
 http://localhost:3000/admin/books/<BOOK_ID>/versions
```

## Rate limiting

- –í–∫–ª—é—á–µ–Ω–∏–µ: `RATE_LIMIT_ENABLED=1` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
  - `RATE_LIMIT_COMMENTS_PER_MINUTE` ‚Äî —á–∏—Å–ª–æ –¥–µ–π—Å—Ç–≤–∏–π –≤ –æ–∫–Ω–æ (–¥–µ—Ñ–æ–ª—Ç 10)
  - `RATE_LIMIT_COMMENTS_WINDOW_MS` ‚Äî —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (–¥–µ—Ñ–æ–ª—Ç 60000)
    –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ "PER_MINUTE", –ª–∏–º–∏—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º –æ–∫–Ω–æ–º, –∑–∞–¥–∞–≤–∞–µ–º—ã–º `RATE_LIMIT_COMMENTS_WINDOW_MS`.

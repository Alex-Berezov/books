# –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ api.bibliaris.com

> **–î–∞—Ç–∞:** 18.10.2025  
> **–¶–µ–ª—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å api.bibliaris.com –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ

---

## üéØ –ß—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –∑–∞–ø–∏—Å–∏ api.bibliaris.com ‚Üí 209.74.88.183
2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Caddy –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ api.bibliaris.com –∏ bibliaris.com)
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .env.prod —Å –Ω–æ–≤—ã–º–∏ URL
4. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö endpoints

---

## üìã –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –≤ Namecheap (5 –º–∏–Ω—É—Ç)

**–í–∞–∂–Ω–æ:** –≠—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å!

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Namecheap Advanced DNS](https://ap.www.namecheap.com/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º–µ–Ω `bibliaris.com`
3. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é A-–∑–∞–ø–∏—Å—å:
   ```
   Type: A Record
   Host: api
   Value: 209.74.88.183
   TTL: Automatic
   ```
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-5 –º–∏–Ω—É—Ç –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS

**–ü—Ä–æ–≤–µ—Ä–∫–∞ (–ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ):**

```bash
dig api.bibliaris.com +short
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: 209.74.88.183
```

---

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (10 –º–∏–Ω—É—Ç)

–Ø —Å–æ–∑–¥–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è.

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp scripts/apply-api-subdomain.sh deploy@209.74.88.183:~/

# 2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh deploy@209.74.88.183

# 3. –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤ dry-run —Ä–µ–∂–∏–º–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
bash apply-api-subdomain.sh --dry-run

# 4. –ï—Å–ª–∏ –≤—Å—ë –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
bash apply-api-subdomain.sh

# 5. –í—ã–π–¥–∏—Ç–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
exit
```

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –†—É—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

–ï—Å–ª–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é, —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤:

- `docs/API_SUBDOMAIN_SETUP.md` (–ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è)

---

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (5 –º–∏–Ω—É—Ç)

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ endpoints:

```bash
# –° –≤–∞—à–µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞:

# 1. Health Check
curl https://api.bibliaris.com/api/health/liveness

# 2. Database Check
curl https://api.bibliaris.com/api/health/readiness

# 3. Swagger UI (–æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
https://api.bibliaris.com/docs

# 4. Metrics
curl https://api.bibliaris.com/metrics | head -n 20

# 5. CORS headers
curl -I https://api.bibliaris.com/api/health/liveness \
  -H "Origin: https://bibliaris.com"
# –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å: access-control-allow-origin: https://bibliaris.com

# 6. –û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω (–¥–æ–ª–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å)
curl -I https://bibliaris.com
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 301 –∏ Location: https://api.bibliaris.com/docs
```

**–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å HTTP 200 (–∏–ª–∏ 301 –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞).**

---

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ GitHub Secret ENV_PROD (5 –º–∏–Ω—É—Ç)

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–∏—Ç–µ GitHub Secret –¥–ª—è CI/CD:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [GitHub Secrets](https://github.com/Alex-Berezov/books/settings/secrets/actions)
2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç `ENV_PROD`
3. –ù–∞–∂–º–∏—Ç–µ "Update"
4. –û–±–Ω–æ–≤–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º:
   ```bash
   LOCAL_PUBLIC_BASE_URL=https://api.bibliaris.com
   CORS_ORIGIN=https://bibliaris.com,http://localhost:3000,http://localhost:3001
   ```
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

- ‚úÖ DNS `api.bibliaris.com` —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –≤ `209.74.88.183`
- ‚úÖ `https://api.bibliaris.com/api/health/liveness` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"status":"up"}`
- ‚úÖ `https://api.bibliaris.com/api/health/readiness` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- ‚úÖ `https://api.bibliaris.com/docs` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Swagger UI
- ‚úÖ `https://api.bibliaris.com/metrics` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ Prometheus
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø—É—â–µ–Ω Let's Encrypt –¥–ª—è api.bibliaris.com
- ‚úÖ CORS headers –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–ª—è `https://bibliaris.com`
- ‚úÖ `https://bibliaris.com` —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `https://api.bibliaris.com/docs`
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Å—Ç–∞—Ç—É—Å–µ `healthy`
- ‚úÖ GitHub Secret ENV_PROD –æ–±–Ω–æ–≤–ª–µ–Ω

---

## üêõ Troubleshooting

### DNS –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `dig api.bibliaris.com` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç IP

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Namecheap (Host –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `api`, –Ω–µ `api.bibliaris.com`)
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5-10 –º–∏–Ω—É—Ç –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS
3. –û—á–∏—Å—Ç–∏—Ç–µ DNS –∫—ç—à –ª–æ–∫–∞–ª—å–Ω–æ: `sudo systemd-resolve --flush-caches`

### SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –≤—ã–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `curl https://api.bibliaris.com` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç SSL –æ—à–∏–±–∫—É

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Caddy: `sudo journalctl -u caddy -n 100`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ DNS –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã: `sudo ufw status`
4. Caddy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏

### CORS headers –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ API

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `.env.prod` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `CORS_ORIGIN`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `docker compose -f docker-compose.prod.yml restart app`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏: `curl -I https://api.bibliaris.com/api/health/liveness -H "Origin: https://bibliaris.com"`

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ healthy

**–ü—Ä–æ–±–ª–µ–º–∞:** `docker compose ps` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `unhealthy`

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose -f docker-compose.prod.yml logs app`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞: `docker compose -f docker-compose.prod.yml ps postgres`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ healthcheck –≤—Ä—É—á–Ω—É—é –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   - Caddy: `sudo journalctl -u caddy -n 100`
   - App: `docker compose -f docker-compose.prod.yml logs --tail=100 app`
2. –°–º. [TROUBLESHOOTING.md](../docs/TROUBLESHOOTING.md) –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–±–ª–µ–º
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤: `docker compose -f docker-compose.prod.yml ps`

---

## üéâ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ api.bibliaris.com:

1. ‚úÖ **Backend –≥–æ—Ç–æ–≤** - API –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –Ω–∞ api.bibliaris.com
2. üöÄ **–°–æ–∑–¥–∞—Ç—å Frontend** - –Ω–∞—á–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. üìä **–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã** - `yarn openapi:types:prod` –¥–ª—è TypeScript —Ç–∏–ø–æ–≤
4. üåê **–ó–∞–¥–µ–ø–ª–æ–∏—Ç—å Frontend** - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å bibliaris.com –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞!**

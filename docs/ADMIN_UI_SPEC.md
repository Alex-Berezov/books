# Админка — ТЗ для дизайна (с учётом мультисайта и переводов таксономий)

Цель: спроектировать админ‑панель в стиле WordPress, где весь контент конкретной книги собран в одном месте, SEO встроено внутрь сущностей, язык сайта задаётся глобально (/:lang мультисайт), таксономии локализуются через переводы.

Роли доступа

- admin — все разделы.
- content_manager — контентные разделы (без управления пользователями/ролями).

Глобальные принципы

- Глобальный селектор языка (en/fr/es/pt) в шапке — задаёт единый контекст админки. Все списки, формы и операции работают только в выбранном языке.
- Списки показывают контент текущего языка; создание/редактирование сохраняет данные в этом языке.
- SEO — всегда как блок внутри формы соответствующей сущности (BookVersion/Page), не отдельный раздел.
- Slug паттерн: `^[a-z0-9]+(?:-[a-z0-9]+)*$`; ошибки — инлайн.

Навигация (левое меню)

- Книги
  - Все книги
  - Добавить книгу
- Страницы (CMS)
  - Все страницы
  - Добавить страницу
- Категории (таксономии)
- Теги (таксономии)
- Медиа
- Комментарии
- Пользователи (admin)

---

## Книги

Список «Все книги»

- Фильтры: q (по slug), Опубликовано (есть published версия в текущем языке).
- Таблица (колонки):
  - Slug (кликабельно)
  - Форматы/разделы: Read | Listen | Summary — иконки наличия контента (для текущего языка)
  - Updated At
  - Действия: Редактировать, Удалить
- Пагинация; пустые состояния.

Редактор книги (создать/редактировать)

- Шапка: Slug (text, required, unique), кнопки Сохранить/Удалить.
- Основная рабочая область: вкладки. Работа идёт в глобальном контексте языка — редактор управляет BookVersion текущего языка (без локального переключателя).
  - Overview — общие поля версии (в текущем языке)
    - Title (text, required)
    - Author (text, required)
    - Description (long textarea, required)
    - Cover Image (Media picker, required)
    - Type (select BookType) — если используется
    - isFree (switch)
    - Referral URL (url)
    - SEO (встроенный блок для этой версии):
      - Meta Title (text)
      - Meta Description (textarea)
      - Canonical URL (url)
      - Robots (text)
      - Open Graph: Title, Description, Type, URL (текстовые поля)
  - Read — текстовые главы (для текущей версии в выбранном языке)
    - Список глав: Number, Title, Created, Actions (Редактировать/Удалить)
    - Добавить главу (form): Number (int, unique в версии), Title (text), Content (rich/markdown), Сохранить
  - Listen — аудио‑главы (для текущей версии в выбранном языке)
    - Список аудио‑глав: Number, Title, Duration, Actions
    - Добавить аудио‑главу (form): Number (int, unique), Title (text), Audio URL (Media picker), Duration (int sec), Сохранить
  - Summary — пересказ (для текущей версии в выбранном языке)
    - Summary (long textarea, required)
    - Analysis (long textarea)
    - Themes (long textarea)
    - Сохранить
- Сайдбар (метабоксы):
  - Публикация (для текущей версии/языка): Status (draft/published), Published At (ro), кнопки Publish/Unpublish
  - Категории (см. «Таксономии»): дерево с поиском по переводу в текущем языке; множественный выбор
  - Теги: поле с автодополнением по переводу; множественный выбор
  - Обложка формата: превью coverImage; кнопка «Выбрать из Медиа»

Состояния/валидации

- Версия для выбранного языка не создана: показать пустое состояние с CTA «Создать версию для этого языка». После создания открываются вкладки Read/Listen/Summary.
- Уникальность: BookVersion — одна на язык (создаётся/редактируется только в текущем контексте); Глава и Аудио‑глава — уникальные Number в рамках версии.
- SEO: подсказки по длинам (необязательно блокировать).

---

## Страницы (CMS)

Список

- Фильтры: q, Тип (PageType), Статус (draft/published). Язык — из глобального селектора (показывать только выбранный язык).
- Таблица: Title, Slug, Type, Status, Updated At, Actions (Ред./Удалить).

Редактор страницы

- Поля: Title (text), Slug (text, уникален в пределах языка), Type (select), Content (rich/markdown)
- SEO (встроенный): Meta Title, Meta Description, Canonical URL, Robots, OG Title/Description/Type/URL
- Публикация: draft/published, Published At (ro), Publish/Unpublish
- Язык: берётся из глобального селектора; отображается как метка, изменение — через переключение контекста админки.

---

## Таксономии (переводы Variant B)

Общее

- Базовые сущности: Category (с иерархией), Tag.
- Переводы: для каждого языка создаются записи перевода с полями Name и Slug. В админке управляем переводом только для текущего языка (из глобального селектора). Для редактирования другого языка — переключить язык в шапке.

Категории

- Представления: Дерево (основное), Таблица (flat).
- Фильтры: q (по переводу текущего языка), Тип (CategoryType).
- Операции:
  - Создать базовую категорию: Parent (select), Type (select)
  - Редактировать категорию: вкладки
    - General: Parent (select), Type (select)
    - Перевод (текущий язык): Name (text), Slug (text, уникален в рамках текущего языка); Добавить/Обновить/Удалить перевод текущего языка. Список прочих языков — readonly с подсказкой «переключите язык в шапке для редактирования».
  - Удалить категорию (запрет, если есть дочерние)
- В дереве отображать Name перевода текущего языка; при отсутствии — пометка «Нет перевода для текущего языка».

Теги

- Список + форма редактирования.
- Операции:
  - Создать базовый тег
  - Перевод (текущий язык): Name, Slug (уникален в текущем языке); Добавить/Обновить/Удалить перевод. Список прочих языков — readonly, с подсказкой о переключении глобального языка.
  - Удалить тег

Связи с книгами

- В редакторе книги (метабоксы) выбирать категории/теги по переводу текущего языка. Под капотом привязка идёт к базовому ID. Отображать выбранные элементы по переводу.

---

## Медиа

- Библиотека: поиск (q), тип (image|audio), пагинация.
- Карточка: превью, key, url, createdBy, дата, удалить (soft).
- Загрузка: drag&drop, прогресс, выбор файла для обложек и аудио.

---

## Комментарии

- Фильтры: target (version|chapter|audio), targetId, Язык (определяется через привязку к версии), isHidden, isDeleted, q.
- Таблица: User, Target, Text, Hidden, Deleted, Created, Действия (Hide/Unhide, Delete).

---

## Пользователи (admin)

- Список: q, staff (only|exclude), таблица (Email, Name, Roles, Language Preference, Last Login, Created), действия.
- Профиль/Роли: редактирование name/avatar/languagePreference; модалка ролей (admin/content_manager).

---

## Валидации и ограничения (суммарно)

- Slug: паттерн `^[a-z0-9]+(?:-[a-z0-9]+)*$`.
- Uniqueness:
  - Page: уникально в паре (language, slug).
  - CategoryTranslation/TagTranslation: уникально в паре (language, slug).
  - BookVersion: одна версия на язык для книги ([@@unique([bookId, language])]).
  - Chapter/AudioChapter: уникальный Number в пределах версии.
- Удаление категорий: запрещено, если есть дочерние.

---

## Состояния и UX

- Глобальный переключатель языка сразу меняет списки и формы (открытая страница предлагает сохранить перед переключением).
- Пустые состояния: «Нет версии на этом языке» (CTA создать), «Нет перевода таксономии» (CTA добавить перевод).
- Нотификации: успех/ошибка при CRUD, publish/unpublish, управлении переводами.
- Доступность: клавиатурная навигация, читаемые контрасты, заметные фокусы.

---

## Минимальные экраны/компоненты для дизайна

- Список книг + фильтры + индикаторы форматов.
- Редактор книги: вкладки Overview/Read/Listen/Summary + сайдбар (Публикация/Категории/Теги/Обложка).
- Список/редактор страниц: поля + SEO внутри + публикация.
- Категории: Дерево + Редактор с вкладкой Translations.
- Теги: Список + Редактор с вкладкой Translations.
- Медиа: сетка/таблица + выбор в пикере.
- Комментарии: список + модерация.
- Пользователи: список + роли.

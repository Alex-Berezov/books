## üìä Current Production State - bibliaris.com

> –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è production —Å–µ—Ä–≤–µ—Ä–∞ bibliaris.com
>
> **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-09-28  
> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-09-28 11:45 UTC  
> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê - –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ãurrent Production State - bibliaris.com

> –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è production —Å–µ—Ä–≤–µ—Ä–∞ bibliaris.com
>
> **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-09-28  
> **–°—Ç–∞—Ç—É—Å:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üèóÔ∏è –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–µ—Ä–≤–µ—Ä

- **IP:** 209.74.88.183
- **–û–°:** Ubuntu 24.04.3 LTS
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ø–ª–æ—è:** deploy
- **SSH –¥–æ—Å—Ç—É–ø:** `ssh deploy@209.74.88.183`

### –î–æ–º–µ–Ω –∏ DNS

- **–û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω:** bibliaris.com
- **–¢–µ–∫—É—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ DNS:** Namecheap URL Forward –Ω–∞ www.bibliaris.com
- **–ü—Ä–æ–±–ª–µ–º–∞:** –î–æ–º–µ–Ω –Ω–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è redirect

### –°–µ—Ä–≤–∏—Å—ã (Docker)

#### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Books App

- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:** src-app-1 (books-app:prod)
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ HEALTHY (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω healthcheck)
- **–ü–æ—Ä—Ç—ã:** 0.0.0.0:5000->5000/tcp
- **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:**
  - ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ: `http://localhost:5000/api/health/liveness` (HTTP 200)
  - ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏: `http://localhost:5000/api/metrics` (HTTP 200)
  - ‚ùå –í–Ω–µ—à–Ω–µ: –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω (—Ç—Ä–µ–±—É–µ—Ç reverse proxy)

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL

- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:** src-postgres-1 (postgres:14)
- **–°—Ç–∞—Ç—É—Å:** –ó–∞–ø—É—â–µ–Ω 26+ —á–∞—Å–æ–≤, HEALTHY
- **–ü–æ—Ä—Ç—ã:** 0.0.0.0:5432->5432/tcp

### –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞

```
/opt/books/
‚îú‚îÄ‚îÄ app/          # –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ)
‚îú‚îÄ‚îÄ backups/      # –ö–∞—Ç–∞–ª–æ–≥ –¥–ª—è –±—ç–∫–∞–ø–æ–≤
‚îú‚îÄ‚îÄ logs/         # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ postgres/     # –î–∞–Ω–Ω—ã–µ PostgreSQL
‚îî‚îÄ‚îÄ uploads/      # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
```

### –°–µ—Ç–µ–≤—ã–µ –ø–æ—Ä—Ç—ã (–∞–∫—Ç–∏–≤–Ω—ã–µ)

| –ü–æ—Ä—Ç | –°–µ—Ä–≤–∏—Å     | –°—Ç–∞—Ç—É—Å                 |
| ---- | ---------- | ---------------------- |
| 22   | SSH        | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç            |
| 5000 | Books App  | ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ, ‚ùå –í–Ω–µ—à–Ω–µ |
| 5432 | PostgreSQL | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç            |
| 80   | HTTP       | ‚ùå –ù–µ —Å–ª—É—à–∞–µ—Ç—Å—è        |
| 443  | HTTPS      | ‚ùå –ù–µ —Å–ª—É—à–∞–µ—Ç—Å—è        |

## ‚ùå –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê: Docker Container Status

**–ù–∞–π–¥–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å healthcheck:**

1. **–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ healthcheck**:
   - Healthcheck –ø—ã—Ç–∞–ª—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ `/metrics` (404 Not Found)
   - –ù–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –ø—É—Ç–∏ `/api/metrics` (200 OK)
   - –í `docker-compose.prod.yml` –±—ã–ª–∞ —É–∫–∞–∑–∞–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

2. **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:

   ```bash
   # –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
   cp docker-compose.prod.yml docker-compose.prod.yml.backup

   # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø—É—Ç—å –≤ healthcheck
   sed -i 's|http://localhost:5000/metrics|http://localhost:5000/api/metrics|g' docker-compose.prod.yml

   # –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   docker compose -f docker-compose.prod.yml up -d --force-recreate app
   ```

3. **–†–µ–∑—É–ª—å—Ç–∞—Ç**:
   - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `src-app-1` —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å `(healthy)` ‚úÖ
   - API –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–π
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 2. –ù–µ—Ç reverse proxy

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞ localhost:5000
- –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ HTTPS (Let's Encrypt)
- –ü–æ—Ä—Ç—ã 80/443 –Ω–µ —Å–ª—É—à–∞—é—Ç—Å—è

### 3. DNS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- –î–æ–º–µ–Ω bibliaris.com –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Namecheap URL Forward
- –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ A-record –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞ 209.74.88.183

### 4. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ PORT=3000 –≤ `.env.prod`
- –ù–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 5000
- Healthcheck –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `/metrics` –Ω–∞ localhost:5000

### 5. –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥

- –ö–æ–¥ –≤ `/opt/books/app/src/` - —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è
- –ù–µ—Ç –Ω–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–µ–ø–ª–æ—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üéØ –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- [ ] –ù–∞–π—Ç–∏ docker-compose —Ñ–∞–π–ª—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [ ] –í—ã—è—Å–Ω–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É unhealthy —Å—Ç–∞—Ç—É—Å–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é healthcheck

### –≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS

- [ ] –ò–∑–º–µ–Ω–∏—Ç—å DNS –∑–∞–ø–∏—Å–∏ –≤ Namecheap
- [ ] –°–æ–∑–¥–∞—Ç—å A-record: bibliaris.com ‚Üí 209.74.88.183
- [ ] –£–±—Ä–∞—Ç—å URL Forward

### –≠—Ç–∞–ø 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ reverse proxy

- [ ] **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Caddy** - –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π HTTPS
- [ ] –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å bibliaris.com ‚Üí localhost:5000

### –≠—Ç–∞–ø 4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- [x] **–ò—Å–ø—Ä–∞–≤–∏—Ç—å healthcheck** - ‚úÖ –†–ï–®–ï–ù–û
- [x] **–û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –¥–æ–º–µ–Ω–∞ bibliaris.com** - ‚úÖ –†–ï–®–ï–ù–û
- [ ] –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

### –≠—Ç–∞–ø 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±—ç–∫–∞–ø—ã

- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã

## üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
cd /opt/books/app && ls -la
```

### –ù–∞–π—Ç–∏ docker-compose —Ñ–∞–π–ª—ã

```bash
find /opt/books -name "docker-compose*" 2>/dev/null
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
docker logs src-app-1 --tail 50
docker logs src-postgres-1 --tail 20
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker inspect src-app-1 | jq '.[0].Config.Healthcheck'
docker inspect src-app-1 | jq '.[0].Config.Env'
```

---

**–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:**

- 2025-09-28: –°–æ–∑–¥–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç, –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø–µ—Ä–≤–∏—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- TODO: –î–æ–ø–æ–ª–Ω–∏—Ç—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–æ–≤ –∏ –ø–æ–∏—Å–∫–∞ docker-compose —Ñ–∞–π–ª–æ–≤

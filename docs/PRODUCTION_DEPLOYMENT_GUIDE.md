# üöÄ Production Deployment Guide - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

> –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Books App Backend –≤ production –æ–∫—Ä—É–∂–µ–Ω–∏–∏

## üìã –û–±–∑–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –æ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ production –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### üéØ –ß—Ç–æ –±—É–¥–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ:

- **NestJS API —Å–µ—Ä–≤–µ—Ä** —Å PostgreSQL –∏ Redis
- **Reverse proxy** (Caddy) —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º HTTPS
- **–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** (Prometheus + Grafana + AlertManager)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–∞–π–ª–æ–≤
- **CI/CD pipeline** —á–µ—Ä–µ–∑ GitHub Actions
- **–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### ‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è: 2-4 —á–∞—Å–∞

---

## üèÅ –≠–¢–ê–ü 1: –ü–û–î–ì–û–¢–û–í–ö–ê

### 1.1 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–°–µ—Ä–≤–µ—Ä:**

- Ubuntu 22.04+ –∏–ª–∏ Debian 12+
- –ú–∏–Ω–∏–º—É–º: 2 vCPU, 4GB RAM, 40GB SSD
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ: 4 vCPU, 8GB RAM, 80GB SSD
- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã: 22 (SSH), 80 (HTTP), 443 (HTTPS)

**–î–æ–º–µ–Ω:**

- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: `api.yourdomain.com`)
- –î–æ—Å—Ç—É–ø –∫ DNS –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º

**–õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞:**

- Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- SSH –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É
- Docker –∏ Docker Compose (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

### 1.2 –°–æ–∑–¥–∞–Ω–∏–µ SSH –∫–ª—é—á–∞ (–µ—Å–ª–∏ –Ω–µ—Ç)

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–∞
ssh-keygen -t ed25519 -C "your-email@example.com"

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
cat ~/.ssh/id_ed25519.pub
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—ã–≤–æ–¥ - –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
```

### 1.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS

–î–æ–±–∞–≤—å—Ç–µ A-–∑–∞–ø–∏—Å—å –≤ DNS –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞:

```
–¢–∏–ø: A
–ò–º—è: api (–∏–ª–∏ @, –µ—Å–ª–∏ –ø–æ–¥–¥–æ–º–µ–Ω –Ω–µ –Ω—É–∂–µ–Ω)
–ó–Ω–∞—á–µ–Ω–∏–µ: IP_–í–ê–®–ï–ì–û_–°–ï–†–í–ï–†–ê
TTL: 300 (5 –º–∏–Ω—É—Ç - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è)
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
dig +short api.yourdomain.com
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
```

---

## üîß –≠–¢–ê–ü 2: –ù–ê–°–¢–†–û–ô–ö–ê –°–ï–†–í–ï–†–ê

### 2.1 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
# –ü–µ—Ä–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–ø–æ–¥ root –∏–ª–∏ —Å sudo)
ssh root@YOUR_SERVER_IP

# –ò–ª–∏ —á–µ—Ä–µ–∑ sudo –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
ssh user@YOUR_SERVER_IP
```

### 2.2 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
curl -o setup_server.sh https://raw.githubusercontent.com/your-repo/main/scripts/setup_server.sh
chmod +x setup_server.sh

# –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
sudo ./setup_server.sh --domain api.yourdomain.com
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**

- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º—É –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Docker –∏ Docker Compose
- –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `deploy` —Å –ø—Ä–∞–≤–∞–º–∏ sudo –∏ docker
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤ `/opt/books/`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤

**–í–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞:**

1. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É (Y/n)
2. –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π SSH –∫–ª—é—á –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (5-10 –º–∏–Ω—É—Ç)

### 2.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è deploy
su deploy
cd /opt/books

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker
docker --version
docker compose version
docker ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–æ–≤
ls -la /opt/books/
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: app/ uploads/ backups/ logs/
```

---

## üì¶ –≠–¢–ê–ü 3: –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### 3.1 –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
# –ü–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º deploy
cd /opt/books/app
git clone https://github.com/your-username/books-app-back.git .

# –ü—Ä–æ–≤–µ—Ä–∫–∞
ls -la
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–∞–π–ª—ã: package.json, Dockerfile, docker-compose.prod.yml, etc.
```

### 3.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.prod.template .env.prod
vim .env.prod  # –∏–ª–∏ nano .env.prod
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç–µ:**

```bash
# Database
DATABASE_URL=postgresql://books_app:YOUR_STRONG_DB_PASSWORD@postgres:5432/books_app?schema=public

# JWT Secrets (—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ!)
JWT_ACCESS_SECRET=$(openssl rand -base64 32)
JWT_REFRESH_SECRET=$(openssl rand -base64 32)

# –î–æ–º–µ–Ω—ã
LOCAL_PUBLIC_BASE_URL=https://api.yourdomain.com/static
CORS_ORIGIN=https://yourdomain.com,https://app.yourdomain.com

# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
ADMIN_EMAILS=admin@yourdomain.com
CONTENT_MANAGER_EMAILS=editor@yourdomain.com

# PostgreSQL (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–æ–ª—å)
POSTGRES_PASSWORD=YOUR_STRONG_DB_PASSWORD
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞:**

```bash
chmod 600 .env.prod
ls -la .env.prod
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: -rw------- 1 deploy deploy
```

### 3.3 –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
node check_prod_config.js

# –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è
./scripts/deploy_production.sh --version main --force

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞
docker compose -f docker-compose.prod.yml logs -f app
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ:**

1. –°–æ–∑–¥–∞–µ—Ç—Å—è –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
2. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ–¥ –¥–æ –Ω—É–∂–Ω–æ–π –≤–µ—Ä—Å–∏–∏
3. –°–æ–±–∏—Ä–∞–µ—Ç—Å—è Docker –æ–±—Ä–∞–∑
4. –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Å–µ—Ä–≤–∏—Å—ã
6. –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è

### 3.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose -f docker-compose.prod.yml ps

# –ü—Ä–æ–≤–µ—Ä–∫–∏ API
curl http://localhost:5000/api/health/liveness
curl http://localhost:5000/api/health/readiness

# –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
./scripts/health_check.sh --detailed
```

---

## üîí –≠–¢–ê–ü 4: –ù–ê–°–¢–†–û–ô–ö–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 4.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```bash
# –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
sudo ./scripts/setup_security.sh --production

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
./scripts/test_security.sh
```

**–ß—Ç–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è:**

- SSH: –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π, —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏
- UFW Firewall: —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ 22, 80, 443 –ø–æ—Ä—Ç—ã
- Fail2ban: –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 4.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Caddy Reverse Proxy

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Caddy
sudo ./scripts/install_caddy.sh --domain api.yourdomain.com

# –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
curl -I https://api.yourdomain.com/api/health/liveness
```

**Caddy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

- –ü–æ–ª—É—á–∞–µ—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç Let's Encrypt
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç HSTS –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –°–∫—Ä—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç 5000 –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞

---

## üìä –≠–¢–ê–ü 5: –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ë–≠–ö–ê–ü–´

### 5.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
sudo ./scripts/setup_monitoring.sh --production

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
./scripts/test_monitoring.sh

# –î–æ—Å—Ç—É–ø –∫ Grafana
echo "Grafana: http://YOUR_SERVER_IP:3000"
echo "–õ–æ–≥–∏–Ω: admin, –ü–∞—Ä–æ–ª—å: admin (—Å–º–µ–Ω–∏—Ç–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ)"
```

**–ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è:**

- HTTP –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (response time, error rate, throughput)
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (CPU, RAM, –¥–∏—Å–∫, —Å–µ—Ç—å)
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, —Ä–∞–∑–º–µ—Ä, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (—Å—Ç–∞—Ç—É—Å, —Ä–µ—Å—É—Ä—Å—ã)

### 5.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –±—ç–∫–∞–ø–æ–≤
sudo ./scripts/setup_backup_cron.sh --daily --weekly --monthly

# –¢–µ—Å—Ç–æ–≤—ã–π –±—ç–∫–∞–ø
./scripts/backup_database.sh daily

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ç–∫–∞–ø–æ–≤
./scripts/test_backup.sh

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
crontab -l
```

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤:**

- **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00** - –ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø –ë–î –∏ —Ñ–∞–π–ª–æ–≤
- **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 03:00** - –∞—Ä—Ö–∏–≤ –Ω–µ–¥–µ–ª–∏
- **–ï–∂–µ–º–µ—Å—è—á–Ω–æ 1-–≥–æ —á–∏—Å–ª–∞ –≤ 04:00** - –∞—Ä—Ö–∏–≤ –º–µ—Å—è—Ü–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è** - —Ö—Ä–∞–Ω–∏—Ç—Å—è 14 –¥–Ω–µ–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

---

## üîÑ –≠–¢–ê–ü 6: CI/CD PIPELINE

### 6.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Repository

**–î–æ–±–∞–≤—å—Ç–µ Secrets –≤ GitHub Repository Settings ‚Üí Secrets and Variables ‚Üí Actions:**

```
DEPLOY_SSH_KEY - –≤–∞—à –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É
```

**–î–æ–±–∞–≤—å—Ç–µ Variables:**

```
PRODUCTION_SERVER=YOUR_SERVER_IP_OR_DOMAIN
PRODUCTION_DOMAIN=api.yourdomain.com
```

### 6.2 –°–æ–∑–¥–∞–Ω–∏–µ SSH –∫–ª—é—á–∞ –¥–ª—è –¥–µ–ø–ª–æ—è

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ - —Å–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è CI/CD
ssh-keygen -t ed25519 -f ~/.ssh/deploy_key -C "ci-cd-deploy"

# –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh deploy@YOUR_SERVER_IP
echo "YOUR_PUBLIC_KEY_CONTENT" >> ~/.ssh/authorized_keys

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ GitHub Secrets
cat ~/.ssh/deploy_key
# –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–±–∞–≤—å—Ç–µ –≤ DEPLOY_SSH_KEY secret
```

### 6.3 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CI/CD

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–ª–∏–∑
git tag v1.0.0
git push origin v1.0.0

# –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ GitHub Actions
# Repository ‚Üí Actions ‚Üí "Production Deployment" ‚Üí Run workflow
```

**–ü—Ä–æ—Ü–µ—Å—Å CI/CD:**

1. **Tests** - –ª–∏–Ω—Ç–∏–Ω–≥, —Ç–∏–ø—ã, —é–Ω–∏—Ç –∏ e2e —Ç–µ—Å—Ç—ã
2. **Build** - —Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ –∏ push –≤ GHCR
3. **Deploy** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
4. **Verify** - –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è after –¥–µ–ø–ª–æ—è
5. **Notify** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ

---

## üë§ –≠–¢–ê–ü 7: –°–û–ó–î–ê–ù–ò–ï –ü–ï–†–í–û–ì–û –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê

### 7.1 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ email –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `ADMIN_EMAILS`:

```bash
# –ü—Ä–∏–º–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API
curl -X POST https://api.yourdomain.com/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@yourdomain.com",
    "password": "YourStrongPassword123!",
    "name": "Admin User"
  }'
```

### 7.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏

```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
curl -X POST https://api.yourdomain.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@yourdomain.com",
    "password": "YourStrongPassword123!"
  }'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π access_token)
curl https://api.yourdomain.com/api/admin/users/me \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–æ–ª—å `admin` –≤ –æ—Ç–≤–µ—Ç–µ.

---

## ‚úÖ –≠–¢–ê–ü 8: –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê

### 8.1 –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
./scripts/health_check.sh --url https://api.yourdomain.com --detailed --save health_report.json

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
./scripts/test_security.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
./scripts/test_monitoring.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ç–∫–∞–ø–æ–≤
./scripts/test_backup.sh
```

### 8.2 –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

```bash
# API endpoints
curl https://api.yourdomain.com/api/health/liveness
curl https://api.yourdomain.com/api/health/readiness
curl https://api.yourdomain.com/api/books

# SSL –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
curl -I https://api.yourdomain.com/api/docs  # –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 404
nmap -p 22,80,443 YOUR_SERVER_IP  # —Ç–æ–ª—å–∫–æ —ç—Ç–∏ –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã

# –ü—Ä–æ–≤–µ—Ä–∫–∞ redirect HTTP ‚Üí HTTPS
curl -I http://api.yourdomain.com/api/health/liveness
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç 301 ‚Üí https://
```

### 8.3 –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ—Å—Ç–æ–π –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ç–µ—Å—Ç
ab -n 1000 -c 10 https://api.yourdomain.com/api/health/liveness

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–æ –≤—Ä–µ–º—è –Ω–∞–≥—Ä—É–∑–∫–∏
htop  # —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
docker stats  # —Ä–µ—Å—É—Ä—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```

---

## üì± –≠–¢–ê–ü 9: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –§–†–û–ù–¢–ï–ù–î–û–ú

### 9.1 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è OpenAPI —Ç–∏–ø–æ–≤ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
yarn openapi:types:prod

# –§–∞–π–ª –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –≤: libs/api-client/types.ts
```

### 9.2 –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–∞–Ω–¥–µ

**–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–∞–Ω–¥–µ:**

```
API Base URL: https://api.yourdomain.com
OpenAPI Schema: https://api.yourdomain.com/api/docs-json (–≤—Ä–µ–º–µ–Ω–Ω–æ –≤–∫–ª—é—á–∏—Ç—å SWAGGER_ENABLED=1)
Types: libs/api-client/types.ts

CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è:
- https://yourdomain.com
- https://app.yourdomain.com
```

---

## üö® –ü–õ–ê–ù –†–ï–ê–ì–ò–†–û–í–ê–ù–ò–Ø –ù–ê –ò–ù–¶–ò–î–ï–ù–¢–´

### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose -f docker-compose.prod.yml ps
systemctl status docker

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker compose -f docker-compose.prod.yml restart app

# 3. –õ–æ–≥–∏
docker compose -f docker-compose.prod.yml logs app --tail 100
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
docker compose -f docker-compose.prod.yml exec postgres psql -U books_app -d books_app -c "SELECT 1;"

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
./scripts/restore_database.sh
```

**–û—Ç–∫–∞—Ç –¥–µ–ø–ª–æ—è:**

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç
./scripts/deploy_production.sh --rollback

# –†—É—á–Ω–æ–π –æ—Ç–∫–∞—Ç –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
./scripts/deploy_production.sh --version v1.0.0
```

### –ö–æ–Ω—Ç–∞–∫—Ç—ã —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏

- **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:** [–∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–æ–º–∞–Ω–¥—ã]
- **DevOps:** [–∫–æ–Ω—Ç–∞–∫—Ç—ã DevOps –∏–Ω–∂–µ–Ω–µ—Ä–∞]
- **–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:** [–∫–æ–Ω—Ç–∞–∫—Ç—ã —Å–∏—Å–∞–¥–º–∏–Ω–∞]

---

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã:

**–°–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è:**

- `scripts/setup_server.sh` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- `scripts/deploy_production.sh` - –¥–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `scripts/health_check.sh` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

- `.env.prod.template` - template –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `docker-compose.prod.yml` - production compose —Ñ–∞–π–ª
- `.github/workflows/deploy.yml` - CI/CD pipeline

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**

- `docs/DEPLOYMENT_CHECKLIST.md` - —á–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è
- `docs/DEPLOYMENT.md` - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `/opt/books/SERVER_INFO.md` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
docker compose -f docker-compose.prod.yml logs -f app
htop
df -h
systemctl status docker

# –ë—ç–∫–∞–ø—ã
./scripts/backup_database.sh daily
ls -la /opt/books/backups/

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
git pull origin main
./scripts/deploy_production.sh --version main

# –ü—Ä–æ–≤–µ—Ä–∫–∏
./scripts/health_check.sh --detailed
./scripts/test_security.sh
```

---

## üéâ –ì–û–¢–û–í–û!

–í–∞—à Books App Backend —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –≤ production!

**–ß—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å:**

- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π HTTPS API –Ω–∞ –¥–æ–º–µ–Ω–µ api.yourdomain.com
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ CI/CD pipeline –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–ø–ª–æ–µ–≤
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∑–∞—â–∏—Ç—ã
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –≤ Grafana
3. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Slack, email)
4. –ü—Ä–æ–≤–µ–¥–∏—Ç–µ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
5. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è –∫–æ–º–∞–Ω–¥—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:**
–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ `docs/` –∏–ª–∏ –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

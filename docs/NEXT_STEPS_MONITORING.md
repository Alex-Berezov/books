# Next Steps: Monitoring Setup (–ü—É–Ω–∫—Ç 11 DEPLOYMENT.md)

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (27.09.2025)

### ‚úÖ –ß—Ç–æ –ó–ê–í–ï–†–®–ï–ù–û –ü–ï–†–ï–î –≠–¢–ò–ú –≠–¢–ê–ü–û–ú:

1. **–ü—É–Ω–∫—Ç 6 - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (‚úÖ –ó–ê–í–ï–†–®–ï–ù–û):**
   - ‚úÖ `.env.prod` —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
   - ‚úÖ JWT —Å–µ–∫—Ä–µ—Ç—ã, DATABASE_URL, rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
   - ‚úÖ `check_prod_config.js` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

2. **–ü—É–Ω–∫—Ç 7 - Reverse Proxy (‚úÖ –ó–ê–í–ï–†–®–ï–ù–û):**
   - ‚úÖ Caddy –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º HTTPS
   - ‚úÖ Rate limiting, –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `/api/metrics` –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
   - ‚úÖ –°–∫—Ä–∏–ø—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

3. **–ì–æ—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
   - ‚úÖ NestJS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å Prometheus metrics (`/api/metrics`)
   - ‚úÖ Health endpoints (`/api/health/liveness`, `/api/health/readiness`)
   - ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
   - ‚úÖ Reverse proxy –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### üéØ –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –ü—É–Ω–∫—Ç 11 - –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)

## –¶–µ–ª—å:

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è:

1. –°–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –∏–∑ `/api/metrics` (Prometheus)
2. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ (Grafana)
3. –ë–∞–∑–æ–≤—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤ (5xx –æ—à–∏–±–∫–∏, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞

## –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ docker-compose –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–°–æ–∑–¥–∞—Ç—å `docker-compose.monitoring.yml` —Å:

- [ ] Prometheus (—Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫)
- [ ] Grafana (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
- [ ] Node Exporter (–º–µ—Ç—Ä–∏–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞)
- [ ] AlertManager (–∞–ª–µ—Ä—Ç—ã) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

### –®–∞–≥ 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus

–°–æ–∑–¥–∞—Ç—å `configs/prometheus.yml`:

- [ ] Scrape job –¥–ª—è NestJS app (`/api/metrics`)
- [ ] Scrape job –¥–ª—è Node Exporter (—Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏)
- [ ] Retention policy (7-14 –¥–Ω–µ–π –¥–ª—è –Ω–∞—á–∞–ª–∞)
- [ ] –û—Å–Ω–æ–≤–Ω—ã–µ recording rules

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana

–°–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥—ã:

- [ ] NestJS Application Dashboard (HTTP –º–µ—Ç—Ä–∏–∫–∏, response times)
- [ ] System Resources Dashboard (CPU, RAM, Disk)
- [ ] Error Monitoring Dashboard (4xx/5xx rates)
- [ ] Database Connection Pool Dashboard

### –®–∞–≥ 4: –ë–∞–∑–æ–≤—ã–µ –∞–ª–µ—Ä—Ç—ã

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å AlertManager –¥–ª—è:

- [ ] HTTP 5xx rate > 5% –∑–∞ 5 –º–∏–Ω—É—Ç
- [ ] Response time P99 > 2s –∑–∞ 5 –º–∏–Ω—É—Ç
- [ ] Application down (health check fail)
- [ ] High memory usage > 85%

### –®–∞–≥ 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º stack

–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–¥–∞–∫—à–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

- [ ] –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `/api/metrics` –¥–ª—è Prometheus
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Caddy –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ subdomain
- [ ] Security –≥—Ä—É–ø–ø—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –®–∞–≥ 6: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

–°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã:

- [ ] `scripts/setup_monitoring.sh` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] `scripts/test_monitoring.sh` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
- [ ] –ë—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Grafana

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   NestJS App    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Prometheus  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Grafana   ‚îÇ
‚îÇ  /api/metrics   ‚îÇ    ‚îÇ   (9090)     ‚îÇ    ‚îÇ   (3000)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ AlertManager ‚îÇ
                       ‚îÇ   (9093)     ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ  Slack/Email ‚îÇ
                       ‚îÇ   Webhook    ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–ø–ª–∞–Ω):

- `configs/prometheus.yml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
- `configs/grafana/` - –¥–∞—à–±–æ—Ä–¥—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Grafana
- `configs/alertmanager.yml` - –ø—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤
- `docker-compose.monitoring.yml` - —Å–µ—Ä–≤–∏—Å—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `scripts/setup_monitoring.sh` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
- `scripts/test_monitoring.sh` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
- `docs/MONITORING_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

### üîí –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

- Grafana –∑–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (admin/password –∏–∑ env)
- Prometheus –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ —á–µ—Ä–µ–∑ VPN
- AlertManager —Å –∑–∞—â–∏—â–µ–Ω–Ω—ã–º–∏ webhook URL
- `/api/metrics` —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è Prometheus IP

### üåê –î–æ—Å—Ç—É–ø (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è):

- `monitoring.example.com` ‚Üí Grafana (—á–µ—Ä–µ–∑ Caddy)
- `prometheus.example.com` ‚Üí Prometheus (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
- Internal network –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

### üìä NestJS Application:

- HTTP requests/sec –ø–æ –º–µ—Ç–æ–¥–∞–º –∏ —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∞–º
- Response time P50/P95/P99
- Active connections
- Memory/CPU usage –ø—Ä–æ—Ü–µ—Å—Å–∞

### üñ•Ô∏è System Resources:

- CPU usage (user/system/idle)
- Memory usage (used/free/cached)
- Disk usage –∏ I/O
- Network traffic

### üóÑÔ∏è Database (–µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ):

- Connection pool size
- Query execution time
- Slow queries count

## –ê–ª–µ—Ä—Ç—ã (–∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å):

### üö® Critical (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):

- Application down > 1 –º–∏–Ω—É—Ç–∞
- HTTP 5xx rate > 10% –∑–∞ 5 –º–∏–Ω—É—Ç
- Memory usage > 95%
- Disk usage > 90%

### ‚ö†Ô∏è Warning (–≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞):

- HTTP 5xx rate > 5% –∑–∞ 10 –º–∏–Ω—É—Ç
- Response time P99 > 2s –∑–∞ 10 –º–∏–Ω—É—Ç
- Memory usage > 85%
- High CPU usage > 80% –∑–∞ 15 –º–∏–Ω—É—Ç

## –£—Å–ø–µ—à–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏:

- [ ] Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ NestJS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [ ] Grafana –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞—à–±–æ—Ä–¥—ã —Å real-time –¥–∞–Ω–Ω—ã–º–∏
- [ ] –ê–ª–µ—Ä—Ç—ã —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø—Ä–∏ —Å–∏–º—É–ª—è—Ü–∏–∏ –ø—Ä–æ–±–ª–µ–º
- [ ] –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞—Ä—Ç—É–µ—Ç —Å —Å–µ—Ä–≤–µ—Ä–æ–º
- [ ] –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å—Å–æ–∑–¥–∞—Ç—å setup

## –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞:

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ–¥–Ω–æ–º—É –∏–∑:

- **–ü—É–Ω–∫—Ç 18 - –ë—ç–∫–∞–ø—ã** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã PostgreSQL)
- **–ü—É–Ω–∫—Ç 20 - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º** (OpenAPI —Ç–∏–ø—ã)
- **–°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **Prometheus –Ω–µ –≤–∏–¥–∏—Ç –º–µ—Ç—Ä–∏–∫–∏**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å network –≤ Docker, firewall –ø—Ä–∞–≤–∏–ª–∞
2. **Grafana –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ volumes, env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
3. **–ê–ª–µ—Ä—Ç—ã –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å AlertManager –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, webhook URL
4. **–í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å retention policy, sampling

---

–°–æ–∑–¥–∞–Ω: 2025-09-27  
–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é  
–°–ª–µ–¥—É–µ—Ç –ø–æ—Å–ª–µ: –ü—É–Ω–∫—Ç 7 (Reverse Proxy) ‚úÖ  
–ü–µ—Ä–µ–¥: –ü—É–Ω–∫—Ç 18 (–ë—ç–∫–∞–ø—ã) –∏–ª–∏ –ü—É–Ω–∫—Ç 20 (–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
